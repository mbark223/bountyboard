"use strict";var bc=Object.create;var Qr=Object.defineProperty;var vc=Object.getOwnPropertyDescriptor;var wc=Object.getOwnPropertyNames;var xc=Object.getPrototypeOf,Sc=Object.prototype.hasOwnProperty;var ne=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Mn=(r,e)=>{for(var t in e)Qr(r,t,{get:e[t],enumerable:!0})},go=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of wc(e))!Sc.call(r,s)&&s!==t&&Qr(r,s,{get:()=>e[s],enumerable:!(n=vc(e,s))||n.enumerable});return r};var Pe=(r,e,t)=>(t=r!=null?bc(xc(r)):{},go(e||!r||!r.__esModule?Qr(t,"default",{value:r,enumerable:!0}):t,r)),_c=r=>go(Qr({},"__esModule",{value:!0}),r);var su=ne((Qi,nu)=>{var Pn=require("buffer"),Ve=Pn.Buffer;function ru(r,e){for(var t in r)e[t]=r[t]}Ve.from&&Ve.alloc&&Ve.allocUnsafe&&Ve.allocUnsafeSlow?nu.exports=Pn:(ru(Pn,Qi),Qi.Buffer=Dt);function Dt(r,e,t){return Ve(r,e,t)}Dt.prototype=Object.create(Ve.prototype);ru(Ve,Dt);Dt.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return Ve(r,e,t)};Dt.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=Ve(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};Dt.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Ve(r)};Dt.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Pn.SlowBuffer(r)}});var Ki=ne(Vi=>{"use strict";Vi.parse=vd;Vi.serialize=wd;var md=Object.prototype.toString,pd=Object.prototype.hasOwnProperty,hd=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,gd=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,yd=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,bd=/^[\u0020-\u003A\u003D-\u007E]*$/;function vd(r,e){if(typeof r!="string")throw new TypeError("argument str must be a string");var t={},n=r.length;if(n<2)return t;var s=e&&e.decode||xd,i=0,o=0,a=0;do{if(o=r.indexOf("=",i),o===-1)break;if(a=r.indexOf(";",i),a===-1)a=n;else if(o>a){i=r.lastIndexOf(";",o-1)+1;continue}var c=iu(r,i,o),f=ou(r,o,c),l=r.slice(c,f);if(!pd.call(t,l)){var p=iu(r,o+1,a),b=ou(r,a,p);r.charCodeAt(p)===34&&r.charCodeAt(b-1)===34&&(p++,b--);var A=r.slice(p,b);t[l]=_d(A,s)}i=a+1}while(i<n);return t}function iu(r,e,t){do{var n=r.charCodeAt(e);if(n!==32&&n!==9)return e}while(++e<t);return t}function ou(r,e,t){for(;e>t;){var n=r.charCodeAt(--e);if(n!==32&&n!==9)return e+1}return t}function wd(r,e,t){var n=t&&t.encode||encodeURIComponent;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!hd.test(r))throw new TypeError("argument name is invalid");var s=n(e);if(!gd.test(s))throw new TypeError("argument val is invalid");var i=r+"="+s;if(!t)return i;if(t.maxAge!=null){var o=Math.floor(t.maxAge);if(!isFinite(o))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+o}if(t.domain){if(!yd.test(t.domain))throw new TypeError("option domain is invalid");i+="; Domain="+t.domain}if(t.path){if(!bd.test(t.path))throw new TypeError("option path is invalid");i+="; Path="+t.path}if(t.expires){var a=t.expires;if(!Sd(a)||isNaN(a.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+a.toUTCString()}if(t.httpOnly&&(i+="; HttpOnly"),t.secure&&(i+="; Secure"),t.partitioned&&(i+="; Partitioned"),t.priority){var c=typeof t.priority=="string"?t.priority.toLowerCase():t.priority;switch(c){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(t.sameSite){var f=typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite;switch(f){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function xd(r){return r.indexOf("%")!==-1?decodeURIComponent(r):r}function Sd(r){return md.call(r)==="[object Date]"}function _d(r,e){try{return e(r)}catch{return r}}});var uu=ne((Dw,au)=>{var Lr=1e3,Br=Lr*60,Rr=Br*60,qr=Rr*24,Td=qr*365.25;au.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return Nd(r);if(t==="number"&&isNaN(r)===!1)return e.long?Ad(r):Cd(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Nd(r){if(r=String(r),!(r.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Td;case"days":case"day":case"d":return t*qr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Rr;case"minutes":case"minute":case"mins":case"min":case"m":return t*Br;case"seconds":case"second":case"secs":case"sec":case"s":return t*Lr;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Cd(r){return r>=qr?Math.round(r/qr)+"d":r>=Rr?Math.round(r/Rr)+"h":r>=Br?Math.round(r/Br)+"m":r>=Lr?Math.round(r/Lr)+"s":r+"ms"}function Ad(r){return kn(r,qr,"day")||kn(r,Rr,"hour")||kn(r,Br,"minute")||kn(r,Lr,"second")||r+" ms"}function kn(r,e,t){if(!(r<e))return r<e*1.5?Math.floor(r/e)+" "+t:Math.ceil(r/e)+" "+t+"s"}});var Ji=ne((z,cu)=>{z=cu.exports=Zi.debug=Zi.default=Zi;z.coerce=$d;z.disable=Ed;z.enable=kd;z.enabled=Id;z.humanize=uu();z.names=[];z.skips=[];z.formatters={};var Wi;function Pd(r){var e=0,t;for(t in r)e=(e<<5)-e+r.charCodeAt(t),e|=0;return z.colors[Math.abs(e)%z.colors.length]}function Zi(r){function e(){if(e.enabled){var t=e,n=+new Date,s=n-(Wi||n);t.diff=s,t.prev=Wi,t.curr=n,Wi=n;for(var i=new Array(arguments.length),o=0;o<i.length;o++)i[o]=arguments[o];i[0]=z.coerce(i[0]),typeof i[0]!="string"&&i.unshift("%O");var a=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(f,l){if(f==="%%")return f;a++;var p=z.formatters[l];if(typeof p=="function"){var b=i[a];f=p.call(t,b),i.splice(a,1),a--}return f}),z.formatArgs.call(t,i);var c=e.log||z.log||console.log.bind(console);c.apply(t,i)}}return e.namespace=r,e.enabled=z.enabled(r),e.useColors=z.useColors(),e.color=Pd(r),typeof z.init=="function"&&z.init(e),e}function kd(r){z.save(r),z.names=[],z.skips=[];for(var e=(typeof r=="string"?r:"").split(/[\s,]+/),t=e.length,n=0;n<t;n++)e[n]&&(r=e[n].replace(/\*/g,".*?"),r[0]==="-"?z.skips.push(new RegExp("^"+r.substr(1)+"$")):z.names.push(new RegExp("^"+r+"$")))}function Ed(){z.enable("")}function Id(r){var e,t;for(e=0,t=z.skips.length;e<t;e++)if(z.skips[e].test(r))return!1;for(e=0,t=z.names.length;e<t;e++)if(z.names[e].test(r))return!0;return!1}function $d(r){return r instanceof Error?r.stack||r.message:r}});var fu=ne((ve,du)=>{ve=du.exports=Ji();ve.log=Dd;ve.formatArgs=jd;ve.save=Ld;ve.load=lu;ve.useColors=Od;ve.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:Bd();ve.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function Od(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}ve.formatters.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function jd(r){var e=this.useColors;if(r[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+r[0]+(e?"%c ":" ")+"+"+ve.humanize(this.diff),!!e){var t="color: "+this.color;r.splice(1,0,t,"color: inherit");var n=0,s=0;r[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(n++,i==="%c"&&(s=n))}),r.splice(s,0,t)}}function Dd(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function Ld(r){try{r==null?ve.storage.removeItem("debug"):ve.storage.debug=r}catch{}}function lu(){var r;try{r=ve.storage.debug}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}ve.enable(lu());function Bd(){try{return window.localStorage}catch{}}});var gu=ne((ue,hu)=>{var mu=require("tty"),Mr=require("util");ue=hu.exports=Ji();ue.init=Qd;ue.log=zd;ue.formatArgs=Md;ue.save=Fd;ue.load=pu;ue.useColors=qd;ue.colors=[6,2,3,4,5,1];ue.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(s,i){return i.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});var tr=parseInt(process.env.DEBUG_FD,10)||2;tr!==1&&tr!==2&&Mr.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var Rd=tr===1?process.stdout:tr===2?process.stderr:Ud(tr);function qd(){return"colors"in ue.inspectOpts?!!ue.inspectOpts.colors:mu.isatty(tr)}ue.formatters.o=function(r){return this.inspectOpts.colors=this.useColors,Mr.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};ue.formatters.O=function(r){return this.inspectOpts.colors=this.useColors,Mr.inspect(r,this.inspectOpts)};function Md(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,s="  \x1B[3"+n+";1m"+e+" \x1B[0m";r[0]=s+r[0].split(`
`).join(`
`+s),r.push("\x1B[3"+n+"m+"+ue.humanize(this.diff)+"\x1B[0m")}else r[0]=new Date().toUTCString()+" "+e+" "+r[0]}function zd(){return Rd.write(Mr.format.apply(Mr,arguments)+`
`)}function Fd(r){r==null?delete process.env.DEBUG:process.env.DEBUG=r}function pu(){return process.env.DEBUG}function Ud(r){var e,t=process.binding("tty_wrap");switch(t.guessHandleType(r)){case"TTY":e=new mu.WriteStream(r),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(r,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var s=require("net");e=new s.Socket({fd:r,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=r,e._isStdio=!0,e}function Qd(r){r.inspectOpts={};for(var e=Object.keys(ue.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=ue.inspectOpts[e[t]]}ue.enable(pu())});var yu=ne((Lw,Hi)=>{typeof process<"u"&&process.type==="renderer"?Hi.exports=fu():Hi.exports=gu()});var Xi=ne((Bw,xu)=>{var Vd=require("path").relative;xu.exports=Hd;var Kd=process.cwd();function vu(r,e){for(var t=r.split(/[ ,]+/),n=String(e).toLowerCase(),s=0;s<t.length;s++){var i=t[s];if(i&&(i==="*"||i.toLowerCase()===n))return!0}return!1}function Wd(r,e,t){var n=Object.getOwnPropertyDescriptor(r,e),s=n.value;return n.get=function(){return s},n.writable&&(n.set=function(o){return s=o}),delete n.value,delete n.writable,Object.defineProperty(r,e,n),n}function Zd(r){for(var e="",t=0;t<r;t++)e+=", arg"+t;return e.substr(2)}function Jd(r){var e=this.name+": "+this.namespace;this.message&&(e+=" deprecated "+this.message);for(var t=0;t<r.length;t++)e+=`
    at `+r[t].toString();return e}function Hd(r){if(!r)throw new TypeError("argument namespace is required");var e=In(),t=rr(e[1]),n=t[0];function s(i){En.call(s,i)}return s._file=n,s._ignored=Xd(r),s._namespace=r,s._traced=Yd(r),s._warned=Object.create(null),s.function=nf,s.property=sf,s}function Gd(r,e){var t=typeof r.listenerCount!="function"?r.listeners(e).length:r.listenerCount(e);return t>0}function Xd(r){if(process.noDeprecation)return!0;var e=process.env.NO_DEPRECATION||"";return vu(e,r)}function Yd(r){if(process.traceDeprecation)return!0;var e=process.env.TRACE_DEPRECATION||"";return vu(e,r)}function En(r,e){var t=Gd(process,"deprecation");if(!(!t&&this._ignored)){var n,s,i,o,a=0,c=!1,f=In(),l=this._file;for(e?(o=e,i=rr(f[1]),i.name=o.name,l=i[0]):(a=2,o=rr(f[a]),i=o);a<f.length;a++)if(n=rr(f[a]),s=n[0],s===l)c=!0;else if(s===this._file)l=this._file;else if(c)break;var p=n?o.join(":")+"__"+n.join(":"):void 0;if(!(p!==void 0&&p in this._warned)){this._warned[p]=!0;var b=r;if(b||(b=i===o||!i.name?bu(o):bu(i)),t){var A=wu(this._namespace,b,f.slice(a));process.emit("deprecation",A);return}var L=process.stderr.isTTY?tf:ef,_=L.call(this,b,n,f.slice(a));process.stderr.write(_+`
`,"utf8")}}}function rr(r){var e=r.getFileName()||"<anonymous>",t=r.getLineNumber(),n=r.getColumnNumber();r.isEval()&&(e=r.getEvalOrigin()+", "+e);var s=[e,t,n];return s.callSite=r,s.name=r.getFunctionName(),s}function bu(r){var e=r.callSite,t=r.name;t||(t="<anonymous@"+Gi(r)+">");var n=e.getThis(),s=n&&e.getTypeName();return s==="Object"&&(s=void 0),s==="Function"&&(s=n.name||s),s&&e.getMethodName()?s+"."+t:t}function ef(r,e,t){var n=new Date().toUTCString(),s=n+" "+this._namespace+" deprecated "+r;if(this._traced){for(var i=0;i<t.length;i++)s+=`
    at `+t[i].toString();return s}return e&&(s+=" at "+Gi(e)),s}function tf(r,e,t){var n="\x1B[36;1m"+this._namespace+"\x1B[22;39m \x1B[33;1mdeprecated\x1B[22;39m \x1B[0m"+r+"\x1B[39m";if(this._traced){for(var s=0;s<t.length;s++)n+=`
    \x1B[36mat `+t[s].toString()+"\x1B[39m";return n}return e&&(n+=" \x1B[36m"+Gi(e)+"\x1B[39m"),n}function Gi(r){return Vd(Kd,r[0])+":"+r[1]+":"+r[2]}function In(){var r=Error.stackTraceLimit,e={},t=Error.prepareStackTrace;Error.prepareStackTrace=rf,Error.stackTraceLimit=Math.max(10,r),Error.captureStackTrace(e);var n=e.stack.slice(1);return Error.prepareStackTrace=t,Error.stackTraceLimit=r,n}function rf(r,e){return e}function nf(r,e){if(typeof r!="function")throw new TypeError("argument fn must be a function");var t=Zd(r.length),n=In(),s=rr(n[1]);s.name=r.name;var i=new Function("fn","log","deprecate","message","site",`"use strict"
return function (`+t+`) {log.call(deprecate, message, site)
return fn.apply(this, arguments)
}`)(r,En,this,e,s);return i}function sf(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new TypeError("argument obj must be object");var n=Object.getOwnPropertyDescriptor(r,e);if(!n)throw new TypeError("must call property on owner object");if(!n.configurable)throw new TypeError("property must be configurable");var s=this,i=In(),o=rr(i[1]);o.name=e,"value"in n&&(n=Wd(r,e,t));var a=n.get,c=n.set;typeof a=="function"&&(n.get=function(){return En.call(s,t,o),a.apply(this,arguments)}),typeof c=="function"&&(n.set=function(){return En.call(s,t,o),c.apply(this,arguments)}),Object.defineProperty(r,e,n)}function wu(r,e,t){var n=new Error,s;return Object.defineProperty(n,"constructor",{value:wu}),Object.defineProperty(n,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(n,"name",{enumerable:!1,configurable:!0,value:"DeprecationError",writable:!0}),Object.defineProperty(n,"namespace",{configurable:!0,enumerable:!1,value:r,writable:!0}),Object.defineProperty(n,"stack",{configurable:!0,enumerable:!1,get:function(){return s!==void 0?s:s=Jd.call(this,t)},set:function(o){s=o}}),n}});var _u=ne((Rw,Su)=>{"use strict";Su.exports=lf;var of=require("http"),af=typeof of.ServerResponse.prototype.appendHeader=="function",uf=af?hf:gf;function cf(r,e){var t=!1;return function(s){var i=mf.apply(this,arguments);return t||(t=!0,e.call(this),typeof i[0]=="number"&&this.statusCode!==i[0]&&(i[0]=this.statusCode,i.length=1)),r.apply(this,i)}}function lf(r,e){if(!r)throw new TypeError("argument res is required");if(typeof e!="function")throw new TypeError("argument listener must be a function");r.writeHead=cf(r.writeHead,e)}function df(r,e){if(e.length&&Array.isArray(e[0]))pf(r,e);else{if(e.length%2!==0)throw new TypeError("headers array is malformed");uf(r,e)}}function ff(r,e){for(var t=Object.keys(e),n=0;n<t.length;n++){var s=t[n];s&&r.setHeader(s,e[s])}}function mf(r){var e=arguments.length,t=e>1&&typeof arguments[1]=="string"?2:1,n=e>=t+1?arguments[t]:void 0;this.statusCode=r,Array.isArray(n)?df(this,n):n&&ff(this,n);for(var s=new Array(Math.min(e,t)),i=0;i<s.length;i++)s[i]=arguments[i];return s}function pf(r,e){for(var t,n=0;n<e.length;n++)t=e[n][0],t&&r.setHeader(t,e[n][1])}function hf(r,e){for(var t=0;t<e.length;t+=2)r.removeHeader(e[t]);for(var n,s=0;s<e.length;s+=2)n=e[s],n&&r.appendHeader(n,e[s+1])}function gf(r,e){for(var t,n=0;n<e.length;n+=2)t=e[n],t&&r.setHeader(t,e[n+1])}});var ku=ne((qw,Yi)=>{"use strict";var Nu=require("url"),Tu=Nu.parse,$n=Nu.Url;Yi.exports=Cu;Yi.exports.original=yf;function Cu(r){var e=r.url;if(e!==void 0){var t=r._parsedUrl;return Pu(e,t)?t:(t=Au(e),t._raw=e,r._parsedUrl=t)}}function yf(r){var e=r.originalUrl;if(typeof e!="string")return Cu(r);var t=r._parsedOriginalUrl;return Pu(e,t)?t:(t=Au(e),t._raw=e,r._parsedOriginalUrl=t)}function Au(r){if(typeof r!="string"||r.charCodeAt(0)!==47)return Tu(r);for(var e=r,t=null,n=null,s=1;s<r.length;s++)switch(r.charCodeAt(s)){case 63:n===null&&(e=r.substring(0,s),t=r.substring(s+1),n=r.substring(s));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return Tu(r)}var i=$n!==void 0?new $n:{};return i.path=r,i.href=r,i.pathname=e,n!==null&&(i.query=t,i.search=n),i}function Pu(r,e){return typeof e=="object"&&e!==null&&($n===void 0||e instanceof $n)&&e._raw===r}});var $u=ne(On=>{var Iu=require("crypto");On.sign=function(r,e){if(typeof r!="string")throw new TypeError("Cookie value must be provided as a string.");if(e==null)throw new TypeError("Secret key must be provided.");return r+"."+Iu.createHmac("sha256",e).update(r).digest("base64").replace(/\=+$/,"")};On.unsign=function(r,e){if(typeof r!="string")throw new TypeError("Signed cookie string must be provided.");if(e==null)throw new TypeError("Secret key must be provided.");var t=r.slice(0,r.lastIndexOf(".")),n=On.sign(t,e);return Eu(n)==Eu(r)?t:!1};function Eu(r){return Iu.createHash("sha1").update(r).digest("hex")}});var Ou=ne((zw,ro)=>{"use strict";var jn=require("crypto"),eo=jn.randomBytes===jn.pseudoRandomBytes?1:3;ro.exports=bf;ro.exports.sync=vf;function bf(r,e){if(e!==void 0&&typeof e!="function")throw new TypeError("argument callback must be a function");if(!e&&!global.Promise)throw new TypeError("argument callback is required");return e?to(r,eo,e):new Promise(function(n,s){to(r,eo,function(o,a){if(o)return s(o);n(a)})})}function vf(r){for(var e=null,t=0;t<eo;t++)try{return jn.randomBytes(r)}catch(n){e=n}throw e}function to(r,e,t){jn.randomBytes(r,function(s,i){if(!s)return t(null,i);if(!--e)return t(s);setTimeout(to.bind(null,r,e,t),10)})}});var Bu=ne((Fw,no)=>{"use strict";var Du=Ou(),wf=/=+$/,xf=/\+/g,Sf=/\//g;no.exports=_f;no.exports.sync=Tf;function _f(r,e){if(e!==void 0&&typeof e!="function")throw new TypeError("argument callback must be a function");if(!e&&!global.Promise)throw new TypeError("argument callback is required");return e?ju(r,e):new Promise(function(n,s){ju(r,function(o,a){if(o)return s(o);n(a)})})}function Tf(r){return Lu(Du.sync(r))}function ju(r,e){Du(r,function(t,n){if(t)return e(t);e(null,Lu(n))})}function Lu(r){return r.toString("base64").replace(wf,"").replace(xf,"-").replace(Sf,"_")}});var so=ne((Uw,Ru)=>{"use strict";var Nf=Ki(),Cf=Xi()("express-session"),Af=Ru.exports=function(e){if(this.path="/",this.maxAge=null,this.httpOnly=!0,e){if(typeof e!="object")throw new TypeError("argument options must be a object");for(var t in e)t!=="data"&&(this[t]=e[t])}(this.originalMaxAge===void 0||this.originalMaxAge===null)&&(this.originalMaxAge=this.maxAge)};Af.prototype={set expires(r){this._expires=r,this.originalMaxAge=this.maxAge},get expires(){return this._expires},set maxAge(r){if(r&&typeof r!="number"&&!(r instanceof Date))throw new TypeError("maxAge must be a number or Date");r instanceof Date&&Cf("maxAge as Date; pass number of milliseconds instead"),this.expires=typeof r=="number"?new Date(Date.now()+r):r},get maxAge(){return this.expires instanceof Date?this.expires.valueOf()-Date.now():this.expires},get data(){return{originalMaxAge:this.originalMaxAge,partitioned:this.partitioned,priority:this.priority,expires:this._expires,secure:this.secure,httpOnly:this.httpOnly,domain:this.domain,path:this.path,sameSite:this.sameSite}},serialize:function(r,e){return Nf.serialize(r,e,this.data)},toJSON:function(){return this.data}}});var io=ne((Qw,qu)=>{"use strict";qu.exports=Lt;function Lt(r,e){if(Object.defineProperty(this,"req",{value:r}),Object.defineProperty(this,"id",{value:r.sessionID}),typeof e=="object"&&e!==null)for(var t in e)t in this||(this[t]=e[t])}nr(Lt.prototype,"touch",function(){return this.resetMaxAge()});nr(Lt.prototype,"resetMaxAge",function(){return this.cookie.maxAge=this.cookie.originalMaxAge,this});nr(Lt.prototype,"save",function(e){return this.req.sessionStore.set(this.id,this,e||function(){}),this});nr(Lt.prototype,"reload",function(e){var t=this.req,n=this.req.sessionStore;return n.get(this.id,function(s,i){if(s)return e(s);if(!i)return e(new Error("failed to load session"));n.createSession(t,i),e()}),this});nr(Lt.prototype,"destroy",function(e){return delete this.req.session,this.req.sessionStore.destroy(this.id,e),this});nr(Lt.prototype,"regenerate",function(e){return this.req.sessionStore.regenerate(this.req,e),this});function nr(r,e,t){Object.defineProperty(r,e,{configurable:!0,enumerable:!1,value:t,writable:!0})}});var oo=ne((Vw,zu)=>{"use strict";var Pf=so(),Mu=require("events").EventEmitter,kf=io(),Ef=require("util");zu.exports=zr;function zr(){Mu.call(this)}Ef.inherits(zr,Mu);zr.prototype.regenerate=function(r,e){var t=this;this.destroy(r.sessionID,function(n){t.generate(r),e(n)})};zr.prototype.load=function(r,e){var t=this;this.get(r,function(n,s){if(n)return e(n);if(!s)return e();var i={sessionID:r,sessionStore:t};e(null,t.createSession(i,s))})};zr.prototype.createSession=function(r,e){var t=e.cookie.expires,n=e.cookie.originalMaxAge;return e.cookie=new Pf(e.cookie),typeof t=="string"&&(e.cookie.expires=new Date(t)),e.cookie.originalMaxAge=n,r.session=new kf(r,e),r.session}});var Qu=ne((Kw,Uu)=>{"use strict";var Fu=oo(),If=require("util"),sr=typeof setImmediate=="function"?setImmediate:function(r){process.nextTick(r.bind.apply(r,arguments))};Uu.exports=rt;function rt(){Fu.call(this),this.sessions=Object.create(null)}If.inherits(rt,Fu);rt.prototype.all=function(e){for(var t=Object.keys(this.sessions),n=Object.create(null),s=0;s<t.length;s++){var i=t[s],o=ao.call(this,i);o&&(n[i]=o)}e&&sr(e,null,n)};rt.prototype.clear=function(e){this.sessions=Object.create(null),e&&sr(e)};rt.prototype.destroy=function(e,t){delete this.sessions[e],t&&sr(t)};rt.prototype.get=function(e,t){sr(t,null,ao.call(this,e))};rt.prototype.set=function(e,t,n){this.sessions[e]=JSON.stringify(t),n&&sr(n)};rt.prototype.length=function(e){this.all(function(t,n){if(t)return e(t);e(null,Object.keys(n).length)})};rt.prototype.touch=function(e,t,n){var s=ao.call(this,e);s&&(s.cookie=t.cookie,this.sessions[e]=JSON.stringify(s)),n&&sr(n)};function ao(r){var e=this.sessions[r];if(e){if(e=JSON.parse(e),e.cookie){var t=typeof e.cookie.expires=="string"?new Date(e.cookie.expires):e.cookie.expires;if(t&&t<=Date.now()){delete this.sessions[r];return}}return e}}});var Yu=ne((ir,Xu)=>{"use strict";var Vu=su().Buffer,Zu=Ki(),$f=require("crypto"),W=yu()("express-session"),Ur=Xi()("express-session"),Of=_u(),jf=ku(),Ju=$u(),Df=Bu().sync,Hu=so(),uo=Qu(),Gu=io(),Lf=oo(),Bf="production";ir=Xu.exports=qf;ir.Store=Lf;ir.Cookie=Hu;ir.Session=Gu;ir.MemoryStore=uo;var Rf=`Warning: connect.session() MemoryStore is not
designed for a production environment, as it will leak
memory, and will not scale past a single process.`,Dn=typeof setImmediate=="function"?setImmediate:function(r){process.nextTick(r.bind.apply(r,arguments))};function qf(r){var e=r||{},t=e.cookie||{},n=e.genid||Mf,s=e.name||e.key||"connect.sid",i=e.store||new uo,o=e.proxy,a=e.resave,c=!!e.rolling,f=e.saveUninitialized,l=e.secret;if(typeof n!="function")throw new TypeError("genid option must be a function");if(a===void 0&&(Ur("undefined resave option; provide resave option"),a=!0),f===void 0&&(Ur("undefined saveUninitialized option; provide saveUninitialized option"),f=!0),e.unset&&e.unset!=="destroy"&&e.unset!=="keep")throw new TypeError('unset option must be "destroy" or "keep"');var p=e.unset==="destroy";if(Array.isArray(l)&&l.length===0)throw new TypeError("secret option array must contain one or more strings");l&&!Array.isArray(l)&&(l=[l]),l||Ur("req.secret; provide secret option"),Bf==="production"&&i instanceof uo&&console.warn(Rf),i.generate=function(L){L.sessionID=n(L),L.session=new Gu(L),L.session.cookie=new Hu(t),t.secure==="auto"&&(L.session.cookie.secure=Ku(L,o))};var b=typeof i.touch=="function",A=!0;return i.on("disconnect",function(){A=!1}),i.on("connect",function(){A=!0}),function(_,R,E){if(_.session){E();return}if(!A){W("store is disconnected"),E();return}var ie=jf.original(_).pathname||"/";if(ie.indexOf(t.path||"/")!==0){W("pathname mismatch"),E();return}if(!l&&!_.secret){E(new Error("secret option required for sessions"));return}var oe=l||[_.secret],Z,Ne,X,I=!1;_.sessionStore=i;var j=_.sessionID=zf(_,s,oe);Of(R,function(){if(!_.session){W("no session");return}if(yc(_)){if(_.session.cookie.secure&&!Ku(_,o)){W("not secured");return}I||(_.session.touch(),I=!0);try{Ff(R,s,_.sessionID,oe[0],_.session.cookie.data)}catch(k){Dn(E,k)}}});var re=R.end,mt=R.write,Rt=!1;R.end=function(Q,Be){if(Rt)return!1;Rt=!0;var Re,qt=!0;function ar(){if(qt){Re=re.call(R,Q,Be),qt=!1;return}re.call(R)}function qn(){if(!qt)return Re;if(R._header||R._implicitHeader(),Q==null)return Re=!0,Re;var ur=Number(R.getHeader("Content-Length"));return!isNaN(ur)&&ur>0&&(Q=Vu.isBuffer(Q)?Q:Vu.from(Q,Be),Be=void 0,Q.length!==0)?(W("split response"),Re=mt.call(R,Q.slice(0,Q.length-1)),Q=Q.slice(Q.length-1,Q.length),Re):(Re=mt.call(R,Q,Be),qt=!1,Re)}return Rn(_)?(W("destroying"),i.destroy(_.sessionID,function(st){st&&Dn(E,st),W("destroyed"),ar()}),qn()):_.session?(I||(_.session.touch(),I=!0),ho(_)?(_.session.save(function(st){st&&Dn(E,st),ar()}),qn()):b&&gc(_)?(W("touching"),i.touch(_.sessionID,_.session,function(st){st&&Dn(E,st),W("touched"),ar()}),qn()):re.call(R,Q,Be)):(W("no session"),re.call(R,Q,Be))};function We(){i.generate(_),Ne=_.sessionID,Z=Fr(_.session),Ce(_.session)}function Le(k,Q){i.createSession(k,Q),Ne=k.sessionID,Z=Fr(Q),a||(X=Z),Ce(k.session)}function ge(k,Q){return function(){_.session!==k&&Ce(_.session),Q.apply(this,arguments)}}function Ce(k){var Q=k.reload,Be=k.save;function Re(ar){W("reloading %s",this.id),Q.call(this,ge(this,ar))}function qt(){W("saving %s",this.id),X=Fr(this),Be.apply(this,arguments)}Object.defineProperty(k,"reload",{configurable:!0,enumerable:!1,value:Re,writable:!0}),Object.defineProperty(k,"save",{configurable:!0,enumerable:!1,value:qt,writable:!0})}function pt(k){return Ne!==k.id||Z!==Fr(k)}function Bn(k){return Ne===k.id&&X===Fr(k)}function Rn(k){return k.sessionID&&p&&k.session==null}function ho(k){return typeof k.sessionID!="string"?(W("session ignored because of bogus req.sessionID %o",k.sessionID),!1):!f&&!X&&j!==k.sessionID?pt(k.session):!Bn(k.session)}function gc(k){return typeof k.sessionID!="string"?(W("session ignored because of bogus req.sessionID %o",k.sessionID),!1):j===k.sessionID&&!ho(k)}function yc(k){return typeof k.sessionID!="string"?!1:j!==k.sessionID?f||pt(k.session):c||k.session.cookie.expires!=null&&pt(k.session)}if(!_.sessionID){W("no SID sent, generating session"),We(),E();return}W("fetching %s",_.sessionID),i.get(_.sessionID,function(k,Q){if(k&&k.code!=="ENOENT"){W("error %j",k),E(k);return}try{k||!Q?(W("no session found"),We()):(W("session found"),Le(_,Q))}catch(Be){E(Be);return}E()})}}function Mf(r){return Df(24)}function zf(r,e,t){var n=r.headers.cookie,s,i;if(n){var o=Zu.parse(n);s=o[e],s&&(s.substr(0,2)==="s:"?(i=Wu(s.slice(2),t),i===!1&&(W("cookie signature invalid"),i=void 0)):W("cookie unsigned"))}return!i&&r.signedCookies&&(i=r.signedCookies[e],i&&Ur("cookie should be available in req.headers.cookie")),!i&&r.cookies&&(s=r.cookies[e],s&&(s.substr(0,2)==="s:"?(i=Wu(s.slice(2),t),i&&Ur("cookie should be available in req.headers.cookie"),i===!1&&(W("cookie signature invalid"),i=void 0)):W("cookie unsigned"))),i}function Fr(r){var e=JSON.stringify(r,function(t,n){if(!(this===r&&t==="cookie"))return n});return $f.createHash("sha1").update(e,"utf8").digest("hex")}function Ku(r,e){if(r.connection&&r.connection.encrypted)return!0;if(e===!1)return!1;if(e!==!0)return r.secure===!0;var t=r.headers["x-forwarded-proto"]||"",n=t.indexOf(","),s=n!==-1?t.substr(0,n).toLowerCase().trim():t.toLowerCase().trim();return s==="https"}function Ff(r,e,t,n,s){var i="s:"+Ju.sign(t,n),o=Zu.serialize(e,i,s);W("set-cookie %s",o);var a=r.getHeader("Set-Cookie")||[],c=Array.isArray(a)?a.concat(o):[a,o];r.setHeader("Set-Cookie",c)}function Wu(r,e){for(var t=0;t<e.length;t++){var n=Ju.unsign(r,e[t]);if(n!==!1)return n}return!1}});var nc=ne((Ww,rc)=>{"use strict";var Uf=(r,e)=>{e?r.then(t=>process.nextTick(e,null,t),t=>process.nextTick(e,t||new Error("Promise was rejected with falsy value"))):r.catch(()=>{})},ec=()=>Math.ceil(Date.now()/1e3),tc=r=>r.replaceAll('"','""');rc.exports=function(e){let t=e.Store||e.session.Store;class n extends t{#l;#d;#a;#s;#u;#e;#t;#c;#i;#o;#r;constructor(i={}){if(super(i),this.#i=i.schemaName?tc(i.schemaName):void 0,this.#r=i.tableName?tc(i.tableName):"session",!this.#i&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!i.createTableIfMissing,this.#o=void 0,this.ttl=i.ttl,this.#d=!!i.disableTouch,this.#a=i.errorLog||console.error.bind(console),i.pool!==void 0)this.#e=i.pool,this.#s=!1;else if(i.pgPromise!==void 0){if(typeof i.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#u=i.pgPromise,this.#s=!1}else{let o=i.conString||process.env.DATABASE_URL,a=i.conObject;a||(a={},o&&(a.connectionString=o)),this.#e=new(require("pg")).Pool(a),this.#e.on("error",c=>{this.#a("PG Pool error:",c)}),this.#s=!0}i.pruneSessionInterval===!1?this.#t=!1:(this.#t=(i.pruneSessionInterval||900)*1e3,i.pruneSessionRandomizedInterval!==!1&&(this.#c=i.pruneSessionRandomizedInterval||(o=>Math.ceil(o/2+o*Math.random()))))}async _rawEnsureSessionStoreTable(){let i=this.quotedTable(),o=await this._asyncQuery("SELECT to_regclass($1::text)",[i],!0);if(o&&o.to_regclass===null){let a=require("node:path"),l=(await require("node:fs").promises.readFile(a.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',i);await this._asyncQuery(l,[],!0)}}async _ensureSessionStoreTable(i){if(!(i||this.#l===!1))return this.#o||(this.#o=this._rawEnsureSessionStoreTable()),this.#o}async close(){this.closed=!0,this.#f(),this.#s&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let i=this.#c?this.#c(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},i),this.pruneTimer.unref()}}#f(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(i){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[ec()],o=>{if(i&&typeof i=="function")return i(o);o&&this.#a("Failed to prune sessions:",o),this.#f(),this.#n()})}quotedTable(){let i='"'+this.#r+'"';return this.#i&&(i='"'+this.#i+'".'+i),i}#m(i){let o;if(i&&i.cookie&&i.cookie.expires){let a=new Date(i.cookie.expires);o=Math.ceil(a.valueOf()/1e3)}else{let a=this.ttl||86400;o=Math.ceil(Date.now()/1e3+a)}return o}async _asyncQuery(i,o,a){if(await this._ensureSessionStoreTable(a),this.#u){let c=await this.#u.any(i,o);return c&&c[0]?c[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let c=await this.#e.query(i,o);return c&&c.rows&&c.rows[0]?c.rows[0]:void 0}}query(i,o,a,c){let f;if(typeof o=="function"){if(a)throw new Error("Two callback functions set at once");a=o,f=[]}else f=o||[];let l=this._asyncQuery(i,f,c);Uf(l,a)}get(i,o){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[i,ec()],(a,c)=>{if(a)return o(a);if(!c)return o(null);try{return o(null,typeof c.sess=="string"?JSON.parse(c.sess):c.sess)}catch{return this.destroy(i,o)}})}set(i,o,a){this.#n();let c=this.#m(o),f="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(f,[o,c,i],l=>{a&&a(l)})}destroy(i,o){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[i],a=>{o&&o(a)})}touch(i,o,a){if(this.#n(),this.#d){a&&a(null);return}let c=this.#m(o);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[c,i],f=>{a&&a(f)})}}return n}});var Wf={};Mn(Wf,{log:()=>he});module.exports=_c(Wf);var Ln=Pe(require("express"),1);var Ri={};Mn(Ri,{BUSINESS_LINES:()=>od,STATES:()=>ad,briefs:()=>H,insertBriefSchema:()=>Di,insertPromptTemplateSchema:()=>Bi,insertReviewerSchema:()=>ld,insertSubmissionSchema:()=>Li,promptTemplates:()=>Ae,reviewers:()=>Xa,selectBriefSchema:()=>ud,selectSubmissionSchema:()=>cd,sessions:()=>id,submissions:()=>pe,users:()=>se});var u=Symbol.for("drizzle:entityKind"),Jf=Symbol.for("drizzle:hasOwnEntityKind");function m(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,u))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(r).constructor;if(t)for(;t;){if(u in t&&t[u]===e[u])return!0;t=Object.getPrototypeOf(t)}return!1}var M=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static[u]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Vr=class{static[u]="ColumnBuilder";config;constructor(e,t,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var je=Symbol.for("drizzle:Name");var Kr=class{static[u]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:n,columns:s,foreignColumns:i}=e();return{name:n,columns:s,foreignTable:i[0].table,foreignColumns:i}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new zn(e,this)}},zn=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[u]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:n}=this.reference(),s=t.map(a=>a.name),i=n.map(a=>a.name),o=[this.table[je],...s,n[0].table[je],...i];return e??`${o.join("_")}_fk`}};function Wr(r,...e){return r(...e)}function Qn(r,e){return`${r[je]}_${e.join("_")}_unique`}var Fn=class{constructor(e,t){this.name=t,this.columns=e}static[u]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Un(e,this.columns,this.nullsNotDistinctConfig,this.name)}},yo=class{static[u]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Fn(e,this.name)}},Un=class{constructor(e,t,n,s){this.table=e,this.columns=t,this.name=s??Qn(this.table,this.columns.map(i=>i.name)),this.nullsNotDistinct=n}static[u]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function bo(r,e,t){for(let n=e;n<r.length;n++){let s=r[n];if(s==="\\"){n++;continue}if(s==='"')return[r.slice(e,n).replace(/\\/g,""),n+1];if(!t&&(s===","||s==="}"))return[r.slice(e,n).replace(/\\/g,""),n]}return[r.slice(e).replace(/\\/g,""),r.length]}function vo(r,e=0){let t=[],n=e,s=!1;for(;n<r.length;){let i=r[n];if(i===","){(s||n===e)&&t.push(""),s=!0,n++;continue}if(s=!1,i==="\\"){n+=2;continue}if(i==='"'){let[c,f]=bo(r,n+1,!0);t.push(c),n=f;continue}if(i==="}")return[t,n+1];if(i==="{"){let[c,f]=vo(r,n+1);t.push(c),n=f;continue}let[o,a]=bo(r,n,!1);t.push(o),n=a}return[t,n]}function wo(r){let[e]=vo(r,1);return e}function Vn(r){return`{${r.map(e=>Array.isArray(e)?Vn(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var S=class extends Vr{foreignKeyConfigs=[];static[u]="PgColumnBuilder";array(e){return new Wn(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:n,actions:s})=>Wr((i,o)=>{let a=new Kr(()=>{let c=i();return{columns:[e],foreignColumns:[c]}});return o.onUpdate&&a.onUpdate(o.onUpdate),o.onDelete&&a.onDelete(o.onDelete),a.build(t)},n,s))}buildExtraConfigColumn(e){return new Kn(e,this.config)}},g=class extends M{constructor(e,t){t.uniqueName||(t.uniqueName=Qn(e,[t.name])),super(e,t),this.table=e}static[u]="PgColumn"},Kn=class extends g{static[u]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Mt=class{static[u]="IndexedColumn";constructor(e,t,n,s){this.name=e,this.keyAsName=t,this.type=n,this.indexConfig=s}name;keyAsName;type;indexConfig},Wn=class extends S{static[u]="PgArrayBuilder";constructor(e,t,n){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n}build(e){let t=this.config.baseBuilder.build(e);return new Zn(e,this.config,t)}},Zn=class r extends g{constructor(e,t,n,s){super(e,t),this.baseColumn=n,this.range=s,this.size=t.size}size;static[u]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=wo(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let n=e.map(s=>s===null?null:m(this.baseColumn,r)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s));return t?n:Vn(n)}};var xo=Symbol.for("drizzle:isPgEnum");function _o(r){return!!r&&typeof r=="function"&&xo in r&&r[xo]===!0}var So=class extends S{static[u]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new Jn(e,this.config)}},Jn=class extends g{static[u]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};var ee=class{static[u]="Subquery";constructor(e,t,n,s=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:n,isWith:s}}},zt=class extends ee{static[u]="WithSubquery"};var To="0.39.3";var Hn,Gn,F={startActiveSpan(r,e){return Hn?(Gn||(Gn=Hn.trace.getTracer("drizzle-orm",To)),Wr((t,n)=>n.startActiveSpan(r,s=>{try{return e(s)}catch(i){throw s.setStatus({code:t.SpanStatusCode.ERROR,message:i instanceof Error?i.message:"Unknown error"}),i}finally{s.end()}}),Hn,Gn)):e()}};var U=Symbol.for("drizzle:ViewBaseConfig");var Zr=Symbol.for("drizzle:Schema"),Jr=Symbol.for("drizzle:Columns"),No=Symbol.for("drizzle:ExtraConfigColumns"),Xn=Symbol.for("drizzle:OriginalName"),Yn=Symbol.for("drizzle:BaseName"),cr=Symbol.for("drizzle:IsAlias"),Co=Symbol.for("drizzle:ExtraConfigBuilder"),Ao=Symbol.for("drizzle:IsDrizzleTable"),v=class{static[u]="Table";static Symbol={Name:je,Schema:Zr,OriginalName:Xn,Columns:Jr,ExtraConfigColumns:No,BaseName:Yn,IsAlias:cr,ExtraConfigBuilder:Co};[je];[Xn];[Zr];[Jr];[No];[Yn];[cr]=!1;[Ao]=!0;[Co]=void 0;constructor(e,t,n){this[je]=this[Xn]=e,this[Zr]=t,this[Yn]=n}};function es(r){return typeof r=="object"&&r!==null&&Ao in r}function we(r){return r[je]}function ht(r){return`${r[Zr]??"public"}.${r[je]}`}var Po=class{static[u]="FakePrimitiveParam"};function ts(r){return r!=null&&typeof r.getSQL=="function"}function Tc(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var te=class{static[u]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new x([this])}},x=class r{constructor(e){this.queryChunks=e}static[u]="SQL";decoder=Eo;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return F.startActiveSpan("drizzle.buildSQL",t=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,t){let n=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:s,escapeName:i,escapeParam:o,prepareTyping:a,inlineParams:c,paramStartIndex:f}=n;return Tc(e.map(l=>{if(m(l,te))return{sql:l.value.join(""),params:[]};if(m(l,lr))return{sql:i(l.value),params:[]};if(l===void 0)return{sql:"",params:[]};if(Array.isArray(l)){let p=[new te("(")];for(let[b,A]of l.entries())p.push(A),b<l.length-1&&p.push(new te(", "));return p.push(new te(")")),this.buildQueryFromSourceParams(p,n)}if(m(l,r))return this.buildQueryFromSourceParams(l.queryChunks,{...n,inlineParams:c||l.shouldInlineParams});if(m(l,v)){let p=l[v.Symbol.Schema],b=l[v.Symbol.Name];return{sql:p===void 0||l[cr]?i(b):i(p)+"."+i(b),params:[]}}if(m(l,M)){let p=s.getColumnCasing(l);if(t.invokeSource==="indexes")return{sql:i(p),params:[]};let b=l.table[v.Symbol.Schema];return{sql:l.table[cr]||b===void 0?i(l.table[v.Symbol.Name])+"."+i(p):i(b)+"."+i(l.table[v.Symbol.Name])+"."+i(p),params:[]}}if(m(l,ye)){let p=l[U].schema,b=l[U].name;return{sql:p===void 0||l[U].isAlias?i(b):i(p)+"."+i(b),params:[]}}if(m(l,xe)){if(m(l.value,Ze))return{sql:o(f.value++,l),params:[l],typings:["none"]};let p=l.value===null?null:l.encoder.mapToDriverValue(l.value);if(m(p,r))return this.buildQueryFromSourceParams([p],n);if(c)return{sql:this.mapInlineParam(p,n),params:[]};let b=["none"];return a&&(b=[a(l.encoder)]),{sql:o(f.value++,p),params:[p],typings:b}}return m(l,Ze)?{sql:o(f.value++,l),params:[l],typings:["none"]}:m(l,r.Aliased)&&l.fieldAlias!==void 0?{sql:i(l.fieldAlias),params:[]}:m(l,ee)?l._.isWith?{sql:i(l._.alias),params:[]}:this.buildQueryFromSourceParams([new te("("),l._.sql,new te(") "),new lr(l._.alias)],n):_o(l)?l.schema?{sql:i(l.schema)+"."+i(l.enumName),params:[]}:{sql:i(l.enumName),params:[]}:ts(l)?l.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([l.getSQL()],n):this.buildQueryFromSourceParams([new te("("),l.getSQL(),new te(")")],n):c?{sql:this.mapInlineParam(l,n),params:[]}:{sql:o(f.value++,l),params:[l],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let n=e.toString();return t(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new r.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},lr=class{constructor(e){this.value=e}static[u]="Name";brand;getSQL(){return new x([this])}};function ko(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var Eo={mapFromDriverValue:r=>r},Io={mapToDriverValue:r=>r},Rm={...Eo,...Io},xe=class{constructor(e,t=Io){this.value=e,this.encoder=t}static[u]="Param";brand;getSQL(){return new x([this])}};function d(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new te(r[0]));for(let[n,s]of e.entries())t.push(s,new te(r[n+1]));return new x(t)}(r=>{function e(){return new x([])}r.empty=e;function t(c){return new x(c)}r.fromList=t;function n(c){return new x([new te(c)])}r.raw=n;function s(c,f){let l=[];for(let[p,b]of c.entries())p>0&&f!==void 0&&l.push(f),l.push(b);return new x(l)}r.join=s;function i(c){return new lr(c)}r.identifier=i;function o(c){return new Ze(c)}r.placeholder=o;function a(c,f){return new xe(c,f)}r.param=a})(d||(d={}));(r=>{class e{constructor(n,s){this.sql=n,this.fieldAlias=s}static[u]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(x||(x={}));var Ze=class{constructor(e){this.name=e}static[u]="Placeholder";getSQL(){return new x([this])}};function rs(r,e){return r.map(t=>{if(m(t,Ze)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(m(t,xe)&&m(t.value,Ze)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}var $o=Symbol.for("drizzle:IsDrizzleView"),ye=class{static[u]="View";[U];[$o]=!0;constructor({name:e,schema:t,selectedFields:n,query:s}){this[U]={name:e,originalName:e,schema:t,selectedFields:n,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new x([this])}};function Oo(r){return typeof r=="object"&&r!==null&&$o in r}M.prototype.getSQL=function(){return new x([this])};v.prototype.getSQL=function(){return new x([this])};ee.prototype.getSQL=function(){return new x([this])};var gt=class{constructor(e){this.table=e}static[u]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},Ft=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[u]="TableAliasProxyHandler";get(e,t){if(t===v.Symbol.IsAlias)return!0;if(t===v.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===v.Symbol.OriginalName)return this.alias;if(t===U)return{...e[U],name:this.alias,isAlias:!0};if(t===v.Symbol.Columns){let s=e[v.Symbol.Columns];if(!s)return s;let i={};return Object.keys(s).map(o=>{i[o]=new Proxy(s[o],new gt(new Proxy(e,this)))}),i}let n=e[t];return m(n,M)?new Proxy(n,new gt(new Proxy(e,this))):n}},jo=class{constructor(e){this.alias=e}static[u]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?dr(e.sourceTable,this.alias):e[t]}};function dr(r,e){return new Proxy(r,new Ft(e,!1))}function qe(r,e){return new Proxy(r,new gt(new Proxy(r.table,new Ft(e,!1))))}function ns(r,e){return new x.Aliased(fr(r.sql,e),r.fieldAlias)}function fr(r,e){return d.join(r.queryChunks.map(t=>m(t,M)?qe(t,e):m(t,x)?fr(t,e):m(t,x.Aliased)?ns(t,e):t))}function Do(r,e,t){let n={},s=r.reduce((i,{path:o,field:a},c)=>{let f;m(a,M)?f=a:m(a,x)?f=a.decoder:f=a.sql.decoder;let l=i;for(let[p,b]of o.entries())if(p<o.length-1)b in l||(l[b]={}),l=l[b];else{let A=e[c],L=l[b]=A===null?null:f.mapFromDriverValue(A);if(t&&m(a,M)&&o.length===2){let _=o[0];_ in n?typeof n[_]=="string"&&n[_]!==we(a.table)&&(n[_]=!1):n[_]=L===null?we(a.table):!1}}return i},{});if(t&&Object.keys(n).length>0)for(let[i,o]of Object.entries(n))typeof o=="string"&&!t[o]&&(s[i]=null);return s}function ke(r,e){return Object.entries(r).reduce((t,[n,s])=>{if(typeof n!="string")return t;let i=e?[...e,n]:[n];return m(s,M)||m(s,x)||m(s,x.Aliased)?t.push({path:i,field:s}):m(s,v)?t.push(...ke(s[v.Symbol.Columns],i)):t.push(...ke(s,i)),t},[])}function mr(r,e){let t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(let[s,i]of t.entries())if(i!==n[s])return!1;return!0}function Hr(r,e){let t=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,s])=>m(s,x)||m(s,M)?[n,s]:[n,new xe(s,r[v.Symbol.Columns][n])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Lo(r,e){for(let t of e)for(let n of Object.getOwnPropertyNames(t.prototype))n!=="constructor"&&Object.defineProperty(r.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}function Gr(r){return r[v.Symbol.Columns]}function Bo(r){return r[U].selectedFields}function Je(r){return m(r,ee)?r._.alias:m(r,ye)?r[U].name:m(r,x)?void 0:r[v.Symbol.IsAlias]?r[v.Symbol.Name]:r[v.Symbol.BaseName]}function B(r,e){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:e}}function Ro(r){if(typeof r!="object"||r===null||r.constructor.name!=="Object")return!1;if("logger"in r){let e=typeof r.logger;return!(e!=="boolean"&&(e!=="object"||typeof r.logger.logQuery!="function")&&e!=="undefined")}if("schema"in r){let e=typeof r.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in r){let e=typeof r.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in r)return!(r.mode!=="default"||r.mode!=="planetscale"||r.mode!==void 0);if("connection"in r){let e=typeof r.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in r){let e=typeof r.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(r).length===0}var He=class extends S{static[u]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var ss=class extends He{static[u]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new is(e,this.config)}},is=class extends g{static[u]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},os=class extends He{static[u]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new as(e,this.config)}},as=class extends g{static[u]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function qo(r,e){let{name:t,config:n}=B(r,e);return n.mode==="number"?new ss(t):new os(t)}var us=class extends S{static[u]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new cs(e,this.config)}},cs=class extends g{static[u]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},ls=class extends S{static[u]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new ds(e,this.config)}},ds=class extends g{static[u]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function Mo(r,e){let{name:t,config:n}=B(r,e);return n.mode==="number"?new us(t):new ls(t)}var fs=class extends S{static[u]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ms(e,this.config)}},ms=class extends g{static[u]="PgBoolean";getSQLType(){return"boolean"}};function Xr(r){return new fs(r??"")}var ps=class extends S{static[u]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new hs(e,this.config)}},hs=class extends g{static[u]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function zo(r,e={}){let{name:t,config:n}=B(r,e);return new ps(t,n)}var gs=class extends S{static[u]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new ys(e,this.config)}},ys=class extends g{static[u]="PgCidr";getSQLType(){return"cidr"}};function Fo(r){return new gs(r??"")}var bs=class extends S{static[u]="PgCustomColumnBuilder";constructor(e,t,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=n}build(e){return new vs(e,this.config)}},vs=class extends g{static[u]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function Uo(r){return(e,t)=>{let{name:n,config:s}=B(e,t);return new bs(n,s,r)}}var Me=class extends S{static[u]="PgDateColumnBaseBuilder";defaultNow(){return this.default(d`now()`)}};var ws=class extends Me{static[u]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new pr(e,this.config)}},pr=class extends g{static[u]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},xs=class extends Me{static[u]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new hr(e,this.config)}},hr=class extends g{static[u]="PgDateString";getSQLType(){return"date"}};function Qo(r,e){let{name:t,config:n}=B(r,e);return n?.mode==="date"?new ws(t):new xs(t)}var Ss=class extends S{static[u]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new _s(e,this.config)}},_s=class extends g{static[u]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function Vo(r){return new Ss(r??"")}var Ts=class extends S{static[u]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Ns(e,this.config)}},Ns=class extends g{static[u]="PgInet";getSQLType(){return"inet"}};function Ko(r){return new Ts(r??"")}var Cs=class extends He{static[u]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new As(e,this.config)}},As=class extends g{static[u]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Ge(r){return new Cs(r??"")}var Ps=class extends S{static[u]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new ks(e,this.config)}},ks=class extends g{static[u]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}};function Wo(r,e={}){let{name:t,config:n}=B(r,e);return new Ps(t,n)}var Es=class extends S{static[u]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new gr(e,this.config)}},gr=class extends g{static[u]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Zo(r){return new Es(r??"")}var Is=class extends S{static[u]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new yr(e,this.config)}},yr=class extends g{static[u]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Yr(r){return new Is(r??"")}var $s=class extends S{static[u]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Os(e,this.config)}},Os=class extends g{static[u]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,s]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n),Number.parseFloat(s)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},js=class extends S{static[u]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Ds(e,this.config)}},Ds=class extends g{static[u]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,s]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(n),c:Number.parseFloat(s)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function Jo(r,e){let{name:t,config:n}=B(r,e);return!n?.mode||n.mode==="tuple"?new $s(t):new js(t)}var Ls=class extends S{static[u]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Bs(e,this.config)}},Bs=class extends g{static[u]="PgMacaddr";getSQLType(){return"macaddr"}};function Ho(r){return new Ls(r??"")}var Rs=class extends S{static[u]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new qs(e,this.config)}},qs=class extends g{static[u]="PgMacaddr8";getSQLType(){return"macaddr8"}};function Go(r){return new Rs(r??"")}var Ms=class extends S{static[u]="PgNumericBuilder";constructor(e,t,n){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=n}build(e){return new br(e,this.config)}},br=class extends g{static[u]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function zs(r,e){let{name:t,config:n}=B(r,e);return new Ms(t,n?.precision,n?.scale)}var Xo=zs;var Fs=class extends S{static[u]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Us(e,this.config)}},Us=class extends g{static[u]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Qs=class extends S{static[u]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Vs(e,this.config)}},Vs=class extends g{static[u]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function Yo(r,e){let{name:t,config:n}=B(r,e);return!n?.mode||n.mode==="tuple"?new Fs(t):new Qs(t)}function Nc(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(Number.parseInt(r.slice(t,t+2),16));return new Uint8Array(e)}function ea(r,e){let t=new ArrayBuffer(8),n=new DataView(t);for(let s=0;s<8;s++)n.setUint8(s,r[e+s]);return n.getFloat64(0,!0)}function Ks(r){let e=Nc(r),t=0,n=e[t];t+=1;let s=new DataView(e.buffer),i=s.getUint32(t,n===1);t+=4;let o;if(i&536870912&&(o=s.getUint32(t,n===1),t+=4),(i&65535)===1){let a=ea(e,t);t+=8;let c=ea(e,t);return t+=8,[a,c]}throw new Error("Unsupported geometry type")}var Ws=class extends S{static[u]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new Zs(e,this.config)}},Zs=class extends g{static[u]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Ks(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},Js=class extends S{static[u]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new Hs(e,this.config)}},Hs=class extends g{static[u]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=Ks(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function ta(r,e){let{name:t,config:n}=B(r,e);return!n?.mode||n.mode==="tuple"?new Ws(t):new Js(t)}var Gs=class extends S{static[u]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new Xs(e,this.config)}},Xs=class extends g{static[u]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function ra(r){return new Gs(r??"")}var Ys=class extends S{static[u]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ei(e,this.config)}},ei=class extends g{static[u]="PgSerial";getSQLType(){return"serial"}};function yt(r){return new Ys(r??"")}var ti=class extends He{static[u]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new ri(e,this.config)}},ri=class extends g{static[u]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function na(r){return new ti(r??"")}var ni=class extends S{static[u]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new si(e,this.config)}},si=class extends g{static[u]="PgSmallSerial";getSQLType(){return"smallserial"}};function sa(r){return new ni(r??"")}var ii=class extends S{static[u]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new oi(e,this.config)}},oi=class extends g{static[u]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function N(r,e={}){let{name:t,config:n}=B(r,e);return new ii(t,n)}var ai=class extends Me{constructor(e,t,n){super(e,"string","PgTime"),this.withTimezone=t,this.precision=n,this.config.withTimezone=t,this.config.precision=n}static[u]="PgTimeBuilder";build(e){return new vr(e,this.config)}},vr=class extends g{static[u]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function ia(r,e={}){let{name:t,config:n}=B(r,e);return new ai(t,n.withTimezone??!1,n.precision)}var ui=class extends Me{static[u]="PgTimestampBuilder";constructor(e,t,n){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=n}build(e){return new wr(e,this.config)}},wr=class extends g{static[u]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},ci=class extends Me{static[u]="PgTimestampStringBuilder";constructor(e,t,n){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=n}build(e){return new xr(e,this.config)}},xr=class extends g{static[u]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function le(r,e={}){let{name:t,config:n}=B(r,e);return n?.mode==="string"?new ci(t,n.withTimezone??!1,n.precision):new ui(t,n?.withTimezone??!1,n?.precision)}var li=class extends S{static[u]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(d`gen_random_uuid()`)}build(e){return new Sr(e,this.config)}},Sr=class extends g{static[u]="PgUUID";getSQLType(){return"uuid"}};function oa(r){return new li(r??"")}var di=class extends S{static[u]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new fi(e,this.config)}},fi=class extends g{static[u]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function Ee(r,e={}){let{name:t,config:n}=B(r,e);return new di(t,n)}var mi=class extends S{static[u]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new pi(e,this.config)}},pi=class extends g{static[u]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function aa(r,e){let{name:t,config:n}=B(r,e);return new mi(t,n)}var hi=class extends S{static[u]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new gi(e,this.config)}},gi=class extends g{static[u]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function ua(r,e){let{name:t,config:n}=B(r,e);return new hi(t,n)}var yi=class extends S{static[u]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new bi(e,this.config)}},bi=class extends g{static[u]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function ca(r,e){let{name:t,config:n}=B(r,e);return new yi(t,n)}var vi=class extends S{static[u]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new wi(e,this.config)}},wi=class extends g{static[u]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function la(r,e){let{name:t,config:n}=B(r,e);return new vi(t,n)}var de=class{static[u]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};var G=class r{static[u]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===U)return{...e[U],selectedFields:new Proxy(e[U].selectedFields,this)};if(typeof t=="symbol")return e[t];let s=(m(e,ee)?e._.selectedFields:m(e,ye)?e[U].selectedFields:e)[t];if(m(s,x.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!s.isSelectionField)return s.sql;let i=s.clone();return i.isSelectionField=!0,i}if(m(s,x)){if(this.config.sqlBehavior==="sql")return s;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return m(s,M)?this.config.alias?new Proxy(s,new gt(new Proxy(s.table,new Ft(this.config.alias,this.config.replaceOriginalName??!1)))):s:typeof s!="object"||s===null?s:new Proxy(s,new r(this.config))}};var _r=class extends de{constructor(e,t,n,s){super(),this.session=t,this.dialect=n,this.config={table:e,withList:s}}static[u]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[v.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ke(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return F.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>F.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new G({alias:we(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function Cc(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function Ac(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,n,s)=>{let i=s===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return t+i},"")}function Pc(r){return r}var en=class{static[u]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?Cc:e==="camelCase"?Ac:Pc}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[v.Symbol.Schema]??"public",n=e.table[v.Symbol.OriginalName],s=`${t}.${n}.${e.name}`;return this.cache[s]||this.cacheTable(e.table),this.cache[s]}cacheTable(e){let t=e[v.Symbol.Schema]??"public",n=e[v.Symbol.OriginalName],s=`${t}.${n}`;if(!this.cachedTables[s]){for(let i of Object.values(e[v.Symbol.Columns])){let o=`${s}.${i.name}`;this.cache[o]=this.convert(i.name)}this.cachedTables[s]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var Tr=class extends Error{static[u]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},tn=class extends Tr{static[u]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};function da(){return{bigint:qo,bigserial:Mo,boolean:Xr,char:zo,cidr:Fo,customType:Uo,date:Qo,doublePrecision:Vo,inet:Ko,integer:Ge,interval:Wo,json:Zo,jsonb:Yr,line:Jo,macaddr:Ho,macaddr8:Go,numeric:zs,point:Yo,geometry:ta,real:ra,serial:yt,smallint:na,smallserial:sa,text:N,time:ia,timestamp:le,uuid:oa,varchar:Ee,bit:aa,halfvec:ua,sparsevec:ca,vector:la}}var xi=Symbol.for("drizzle:PgInlineForeignKeys"),fa=Symbol.for("drizzle:EnableRLS"),ae=class extends v{static[u]="PgTable";static Symbol=Object.assign({},v.Symbol,{InlineForeignKeys:xi,EnableRLS:fa});[xi]=[];[fa]=!1;[v.Symbol.ExtraConfigBuilder]=void 0};function kc(r,e,t,n,s=r){let i=new ae(r,n,s),o=typeof e=="function"?e(da()):e,a=Object.fromEntries(Object.entries(o).map(([l,p])=>{let b=p;b.setName(l);let A=b.build(i);return i[xi].push(...b.buildForeignKeys(A,i)),[l,A]})),c=Object.fromEntries(Object.entries(o).map(([l,p])=>{let b=p;b.setName(l);let A=b.buildExtraConfigColumn(i);return[l,A]})),f=Object.assign(i,a);return f[v.Symbol.Columns]=a,f[v.Symbol.ExtraConfigColumns]=c,t&&(f[ae.Symbol.ExtraConfigBuilder]=t),Object.assign(f,{enableRLS:()=>(f[ae.Symbol.EnableRLS]=!0,f)})}var it=(r,e,t)=>kc(r,e,t,void 0);var rn=class{static[u]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new Si(e,this.columns,this.name)}},Si=class{constructor(e,t,n){this.table=e,this.columns=t,this.name=n}static[u]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[ae.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function Se(r,e){return ko(e)&&!ts(r)&&!m(r,xe)&&!m(r,Ze)&&!m(r,M)&&!m(r,v)&&!m(r,ye)?new xe(r,e):r}var V=(r,e)=>d`${r} = ${Se(e,r)}`,ma=(r,e)=>d`${r} <> ${Se(e,r)}`;function Nr(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new x(e):new x([new te("("),d.join(e,new te(" and ")),new te(")")])}function pa(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new x(e):new x([new te("("),d.join(e,new te(" or ")),new te(")")])}function ha(r){return d`not ${r}`}var ga=(r,e)=>d`${r} > ${Se(e,r)}`,ya=(r,e)=>d`${r} >= ${Se(e,r)}`,ba=(r,e)=>d`${r} < ${Se(e,r)}`,va=(r,e)=>d`${r} <= ${Se(e,r)}`;function wa(r,e){return Array.isArray(e)?e.length===0?d`false`:d`${r} in ${e.map(t=>Se(t,r))}`:d`${r} in ${Se(e,r)}`}function xa(r,e){return Array.isArray(e)?e.length===0?d`true`:d`${r} not in ${e.map(t=>Se(t,r))}`:d`${r} not in ${Se(e,r)}`}function Sa(r){return d`${r} is null`}function _a(r){return d`${r} is not null`}function Ta(r){return d`exists ${r}`}function Na(r){return d`not exists ${r}`}function Ca(r,e,t){return d`${r} between ${Se(e,r)} and ${Se(t,r)}`}function Aa(r,e,t){return d`${r} not between ${Se(e,r)} and ${Se(t,r)}`}function Pa(r,e){return d`${r} like ${e}`}function ka(r,e){return d`${r} not like ${e}`}function Ea(r,e){return d`${r} ilike ${e}`}function Ia(r,e){return d`${r} not ilike ${e}`}function $a(r){return d`${r} asc`}function bt(r){return d`${r} desc`}var nn=class{constructor(e,t,n){this.sourceTable=e,this.referencedTable=t,this.relationName=n,this.referencedTableName=t[v.Symbol.Name]}static[u]="Relation";referencedTableName;fieldName},_i=class{constructor(e,t){this.table=e,this.config=t}static[u]="Relations"},ot=class r extends nn{constructor(e,t,n,s){super(e,t,n?.relationName),this.config=n,this.isNullable=s}static[u]="One";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},Cr=class r extends nn{constructor(e,t,n){super(e,t,n?.relationName),this.config=n}static[u]="Many";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function Oa(){return{and:Nr,between:Ca,eq:V,exists:Ta,gt:ga,gte:ya,ilike:Ea,inArray:wa,isNull:Sa,isNotNull:_a,like:Pa,lt:ba,lte:va,ne:ma,not:ha,notBetween:Aa,notExists:Na,notLike:ka,notIlike:Ia,notInArray:xa,or:pa,sql:d}}function ja(){return{sql:d,asc:$a,desc:bt}}function Da(r,e){Object.keys(r).length===1&&"default"in r&&!m(r.default,v)&&(r=r.default);let t={},n={},s={};for(let[i,o]of Object.entries(r))if(m(o,v)){let a=ht(o),c=n[a];t[a]=i,s[i]={tsName:i,dbName:o[v.Symbol.Name],schema:o[v.Symbol.Schema],columns:o[v.Symbol.Columns],relations:c?.relations??{},primaryKey:c?.primaryKey??[]};for(let l of Object.values(o[v.Symbol.Columns]))l.primary&&s[i].primaryKey.push(l);let f=o[v.Symbol.ExtraConfigBuilder]?.(o[v.Symbol.ExtraConfigColumns]);if(f)for(let l of Object.values(f))m(l,rn)&&s[i].primaryKey.push(...l.columns)}else if(m(o,_i)){let a=ht(o.table),c=t[a],f=o.config(e(o.table)),l;for(let[p,b]of Object.entries(f))if(c){let A=s[c];A.relations[p]=b,l&&A.primaryKey.push(...l)}else a in n||(n[a]={relations:{},primaryKey:l}),n[a].relations[p]=b}return{tables:s,tableNamesMap:t}}function Ec(r){return function(t,n){return new ot(r,t,n,n?.fields.reduce((s,i)=>s&&i.notNull,!0)??!1)}}function Ic(r){return function(t,n){return new Cr(r,t,n)}}function La(r,e,t){if(m(t,ot)&&t.config)return{fields:t.config.fields,references:t.config.references};let n=e[ht(t.referencedTable)];if(!n)throw new Error(`Table "${t.referencedTable[v.Symbol.Name]}" not found in schema`);let s=r[n];if(!s)throw new Error(`Table "${n}" not found in schema`);let i=t.sourceTable,o=e[ht(i)];if(!o)throw new Error(`Table "${i[v.Symbol.Name]}" not found in schema`);let a=[];for(let c of Object.values(s.relations))(t.relationName&&t!==c&&c.relationName===t.relationName||!t.relationName&&c.referencedTable===t.sourceTable)&&a.push(c);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${t.sourceTable[v.Symbol.Name]}". Please specify relation name`);if(a[0]&&m(a[0],ot)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function Ba(r){return{one:Ec(r),many:Ic(r)}}function sn(r,e,t,n,s=i=>i){let i={};for(let[o,a]of n.entries())if(a.isJson){let c=e.relations[a.tsKey],f=t[o],l=typeof f=="string"?JSON.parse(f):f;i[a.tsKey]=m(c,ot)?l&&sn(r,r[a.relationTableTsKey],l,a.selection,s):l.map(p=>sn(r,r[a.relationTableTsKey],p,a.selection,s))}else{let c=s(t[o]),f=a.field,l;m(f,M)?l=f:m(f,x)?l=f.decoder:l=f.sql.decoder,i[a.tsKey]=c===null?null:l.mapFromDriverValue(c)}return i}var Ut=class extends ye{static[u]="PgViewBase"};var at=class{static[u]="PgDialect";casing;constructor(e){this.casing=new en(e?.casing)}async migrate(e,t,n){let s=typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",i=typeof n=="string"?"drizzle":n.migrationsSchema??"drizzle",o=d`
			CREATE TABLE IF NOT EXISTS ${d.identifier(i)}.${d.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(d`CREATE SCHEMA IF NOT EXISTS ${d.identifier(i)}`),await t.execute(o);let c=(await t.all(d`select id, hash, created_at from ${d.identifier(i)}.${d.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async f=>{for await(let l of e)if(!c||Number(c.created_at)<l.folderMillis){for(let p of l.sql)await f.execute(d.raw(p));await f.execute(d`insert into ${d.identifier(i)}.${d.identifier(s)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[d`with `];for(let[n,s]of e.entries())t.push(d`${d.identifier(s._.alias)} as (${s._.sql})`),n<e.length-1&&t.push(d`, `);return t.push(d` `),d.join(t)}buildDeleteQuery({table:e,where:t,returning:n,withList:s}){let i=this.buildWithCTE(s),o=n?d` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,a=t?d` where ${t}`:void 0;return d`${i}delete from ${e}${a}${o}`}buildUpdateSet(e,t){let n=e[v.Symbol.Columns],s=Object.keys(n).filter(o=>t[o]!==void 0||n[o]?.onUpdateFn!==void 0),i=s.length;return d.join(s.flatMap((o,a)=>{let c=n[o],f=t[o]??d.param(c.onUpdateFn(),c),l=d`${d.identifier(this.casing.getColumnCasing(c))} = ${f}`;return a<i-1?[l,d.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:t,where:n,returning:s,withList:i,from:o,joins:a}){let c=this.buildWithCTE(i),f=e[ae.Symbol.Name],l=e[ae.Symbol.Schema],p=e[ae.Symbol.OriginalName],b=f===p?void 0:f,A=d`${l?d`${d.identifier(l)}.`:void 0}${d.identifier(p)}${b&&d` ${d.identifier(b)}`}`,L=this.buildUpdateSet(e,t),_=o&&d.join([d.raw(" from "),this.buildFromTable(o)]),R=this.buildJoins(a),E=s?d` returning ${this.buildSelection(s,{isSingleTable:!o})}`:void 0,ie=n?d` where ${n}`:void 0;return d`${c}update ${A} set ${L}${_}${R}${ie}${E}`}buildSelection(e,{isSingleTable:t=!1}={}){let n=e.length,s=e.flatMap(({field:i},o)=>{let a=[];if(m(i,x.Aliased)&&i.isSelectionField)a.push(d.identifier(i.fieldAlias));else if(m(i,x.Aliased)||m(i,x)){let c=m(i,x.Aliased)?i.sql:i;t?a.push(new x(c.queryChunks.map(f=>m(f,g)?d.identifier(this.casing.getColumnCasing(f)):f))):a.push(c),m(i,x.Aliased)&&a.push(d` as ${d.identifier(i.fieldAlias)}`)}else m(i,M)&&(t?a.push(d.identifier(this.casing.getColumnCasing(i))):a.push(i));return o<n-1&&a.push(d`, `),a});return d.join(s)}buildJoins(e){if(!e||e.length===0)return;let t=[];for(let[n,s]of e.entries()){n===0&&t.push(d` `);let i=s.table,o=s.lateral?d` lateral`:void 0;if(m(i,ae)){let a=i[ae.Symbol.Name],c=i[ae.Symbol.Schema],f=i[ae.Symbol.OriginalName],l=a===f?void 0:s.alias;t.push(d`${d.raw(s.joinType)} join${o} ${c?d`${d.identifier(c)}.`:void 0}${d.identifier(f)}${l&&d` ${d.identifier(l)}`} on ${s.on}`)}else if(m(i,ye)){let a=i[U].name,c=i[U].schema,f=i[U].originalName,l=a===f?void 0:s.alias;t.push(d`${d.raw(s.joinType)} join${o} ${c?d`${d.identifier(c)}.`:void 0}${d.identifier(f)}${l&&d` ${d.identifier(l)}`} on ${s.on}`)}else t.push(d`${d.raw(s.joinType)} join${o} ${i} on ${s.on}`);n<e.length-1&&t.push(d` `)}return d.join(t)}buildFromTable(e){if(m(e,v)&&e[v.Symbol.OriginalName]!==e[v.Symbol.Name]){let t=d`${d.identifier(e[v.Symbol.OriginalName])}`;return e[v.Symbol.Schema]&&(t=d`${d.identifier(e[v.Symbol.Schema])}.${t}`),d`${t} ${d.identifier(e[v.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:n,where:s,having:i,table:o,joins:a,orderBy:c,groupBy:f,limit:l,offset:p,lockingClause:b,distinct:A,setOperators:L}){let _=n??ke(t);for(let ge of _)if(m(ge.field,M)&&we(ge.field.table)!==(m(o,ee)?o._.alias:m(o,Ut)?o[U].name:m(o,x)?void 0:we(o))&&!(Ce=>a?.some(({alias:pt})=>pt===(Ce[v.Symbol.IsAlias]?we(Ce):Ce[v.Symbol.BaseName])))(ge.field.table)){let Ce=we(ge.field.table);throw new Error(`Your "${ge.path.join("->")}" field references a column "${Ce}"."${ge.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let R=!a||a.length===0,E=this.buildWithCTE(e),ie;A&&(ie=A===!0?d` distinct`:d` distinct on (${d.join(A.on,d`, `)})`);let oe=this.buildSelection(_,{isSingleTable:R}),Z=this.buildFromTable(o),Ne=this.buildJoins(a),X=s?d` where ${s}`:void 0,I=i?d` having ${i}`:void 0,j;c&&c.length>0&&(j=d` order by ${d.join(c,d`, `)}`);let re;f&&f.length>0&&(re=d` group by ${d.join(f,d`, `)}`);let mt=typeof l=="object"||typeof l=="number"&&l>=0?d` limit ${l}`:void 0,Rt=p?d` offset ${p}`:void 0,We=d.empty();if(b){let ge=d` for ${d.raw(b.strength)}`;b.config.of&&ge.append(d` of ${d.join(Array.isArray(b.config.of)?b.config.of:[b.config.of],d`, `)}`),b.config.noWait?ge.append(d` no wait`):b.config.skipLocked&&ge.append(d` skip locked`),We.append(ge)}let Le=d`${E}select${ie} ${oe} from ${Z}${Ne}${X}${re}${I}${j}${mt}${Rt}${We}`;return L.length>0?this.buildSetOperations(Le,L):Le}buildSetOperations(e,t){let[n,...s]=t;if(!n)throw new Error("Cannot pass undefined values to any set operator");return s.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:n,rightSelect:s,limit:i,orderBy:o,offset:a}}){let c=d`(${e.getSQL()}) `,f=d`(${s.getSQL()})`,l;if(o&&o.length>0){let L=[];for(let _ of o)if(m(_,g))L.push(d.identifier(_.name));else if(m(_,x)){for(let R=0;R<_.queryChunks.length;R++){let E=_.queryChunks[R];m(E,g)&&(_.queryChunks[R]=d.identifier(E.name))}L.push(d`${_}`)}else L.push(d`${_}`);l=d` order by ${d.join(L,d`, `)} `}let p=typeof i=="object"||typeof i=="number"&&i>=0?d` limit ${i}`:void 0,b=d.raw(`${t} ${n?"all ":""}`),A=a?d` offset ${a}`:void 0;return d`${c}${b}${f}${l}${p}${A}`}buildInsertQuery({table:e,values:t,onConflict:n,returning:s,withList:i,select:o,overridingSystemValue_:a}){let c=[],f=e[v.Symbol.Columns],l=Object.entries(f).filter(([E,ie])=>!ie.shouldDisableInsert()),p=l.map(([,E])=>d.identifier(this.casing.getColumnCasing(E)));if(o){let E=t;m(E,x)?c.push(E):c.push(E.getSQL())}else{let E=t;c.push(d.raw("values "));for(let[ie,oe]of E.entries()){let Z=[];for(let[Ne,X]of l){let I=oe[Ne];if(I===void 0||m(I,xe)&&I.value===void 0)if(X.defaultFn!==void 0){let j=X.defaultFn(),re=m(j,x)?j:d.param(j,X);Z.push(re)}else if(!X.default&&X.onUpdateFn!==void 0){let j=X.onUpdateFn(),re=m(j,x)?j:d.param(j,X);Z.push(re)}else Z.push(d`default`);else Z.push(I)}c.push(Z),ie<E.length-1&&c.push(d`, `)}}let b=this.buildWithCTE(i),A=d.join(c),L=s?d` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,_=n?d` on conflict ${n}`:void 0,R=a===!0?d`overriding system value `:void 0;return d`${b}insert into ${e} ${p} ${R}${A}${_}${L}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:n}){let s=t?d` concurrently`:void 0,i=n?d` with no data`:void 0;return d`refresh materialized view${s} ${e}${i}`}prepareTyping(e){return m(e,yr)||m(e,gr)?"json":m(e,br)?"decimal":m(e,vr)?"time":m(e,wr)||m(e,xr)?"timestamp":m(e,pr)||m(e,hr)?"date":m(e,Sr)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:s,tableConfig:i,queryConfig:o,tableAlias:a,nestedQueryRelation:c,joinOn:f}){let l=[],p,b,A=[],L,_=[];if(o===!0)l=Object.entries(i.columns).map(([ie,oe])=>({dbKey:oe.name,tsKey:ie,field:qe(oe,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let E=Object.fromEntries(Object.entries(i.columns).map(([I,j])=>[I,qe(j,a)]));if(o.where){let I=typeof o.where=="function"?o.where(E,Oa()):o.where;L=I&&fr(I,a)}let ie=[],oe=[];if(o.columns){let I=!1;for(let[j,re]of Object.entries(o.columns))re!==void 0&&j in i.columns&&(!I&&re===!0&&(I=!0),oe.push(j));oe.length>0&&(oe=I?oe.filter(j=>o.columns?.[j]===!0):Object.keys(i.columns).filter(j=>!oe.includes(j)))}else oe=Object.keys(i.columns);for(let I of oe){let j=i.columns[I];ie.push({tsKey:I,value:j})}let Z=[];o.with&&(Z=Object.entries(o.with).filter(I=>!!I[1]).map(([I,j])=>({tsKey:I,queryConfig:j,relation:i.relations[I]})));let Ne;if(o.extras){Ne=typeof o.extras=="function"?o.extras(E,{sql:d}):o.extras;for(let[I,j]of Object.entries(Ne))ie.push({tsKey:I,value:ns(j,a)})}for(let{tsKey:I,value:j}of ie)l.push({dbKey:m(j,x.Aliased)?j.fieldAlias:i.columns[I].name,tsKey:I,field:m(j,M)?qe(j,a):j,relationTableTsKey:void 0,isJson:!1,selection:[]});let X=typeof o.orderBy=="function"?o.orderBy(E,ja()):o.orderBy??[];Array.isArray(X)||(X=[X]),A=X.map(I=>m(I,M)?qe(I,a):fr(I,a)),p=o.limit,b=o.offset;for(let{tsKey:I,queryConfig:j,relation:re}of Z){let mt=La(t,n,re),Rt=ht(re.referencedTable),We=n[Rt],Le=`${a}_${I}`,ge=Nr(...mt.fields.map((Bn,Rn)=>V(qe(mt.references[Rn],Le),qe(Bn,a)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:e[We],tableConfig:t[We],queryConfig:m(re,ot)?j===!0?{limit:1}:{...j,limit:1}:j,tableAlias:Le,joinOn:ge,nestedQueryRelation:re}),pt=d`${d.identifier(Le)}.${d.identifier("data")}`.as(I);_.push({on:d`true`,table:new ee(Ce.sql,{},Le),alias:Le,joinType:"left",lateral:!0}),l.push({dbKey:I,tsKey:I,field:pt,relationTableTsKey:We,isJson:!0,selection:Ce.selection})}}if(l.length===0)throw new Tr({message:`No fields selected for table "${i.tsName}" ("${a}")`});let R;if(L=Nr(f,L),c){let E=d`json_build_array(${d.join(l.map(({field:Z,tsKey:Ne,isJson:X})=>X?d`${d.identifier(`${a}_${Ne}`)}.${d.identifier("data")}`:m(Z,x.Aliased)?Z.sql:Z),d`, `)})`;m(c,Cr)&&(E=d`coalesce(json_agg(${E}${A.length>0?d` order by ${d.join(A,d`, `)}`:void 0}), '[]'::json)`);let ie=[{dbKey:"data",tsKey:"data",field:E.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:l}];p!==void 0||b!==void 0||A.length>0?(R=this.buildSelectQuery({table:dr(s,a),fields:{},fieldsFlat:[{path:[],field:d.raw("*")}],where:L,limit:p,offset:b,orderBy:A,setOperators:[]}),L=void 0,p=void 0,b=void 0,A=[]):R=dr(s,a),R=this.buildSelectQuery({table:m(R,ae)?R:new ee(R,{},a),fields:{},fieldsFlat:ie.map(({field:Z})=>({path:[],field:m(Z,M)?qe(Z,a):Z})),joins:_,where:L,limit:p,offset:b,orderBy:A,setOperators:[]})}else R=this.buildSelectQuery({table:dr(s,a),fields:{},fieldsFlat:l.map(({field:E})=>({path:[],field:m(E,M)?qe(E,a):E})),joins:_,where:L,limit:p,offset:b,orderBy:A,setOperators:[]});return{tableTsKey:i.tsName,sql:R,selection:l}}};var on=class{static[u]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var fe=class{static[u]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t=!!this.fields,n=e,s;return this.fields?s=this.fields:m(n,ee)?s=Object.fromEntries(Object.keys(n._.selectedFields).map(i=>[i,n[i]])):m(n,Ut)?s=n[U].selectedFields:m(n,x)?s={}:s=Gr(n),new an({table:n,fields:s,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},Ti=class extends on{static[u]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:n,session:s,dialect:i,withList:o,distinct:a}){super(),this.config={withList:o,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=n,this.session=s,this.dialect=i,this._={selectedFields:t},this.tableName=Je(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,n)=>{let s=this.tableName,i=Je(t);if(typeof i=="string"&&this.config.joins?.some(o=>o.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof s=="string"&&(this.config.fields={[s]:this.config.fields}),typeof i=="string"&&!m(t,x))){let o=m(t,ee)?t._.selectedFields:m(t,ye)?t[U].selectedFields:t[v.Symbol.Columns];this.config.fields[i]=o}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new G({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return n=>{let s=typeof n=="function"?n($c()):n;if(!mr(this.getSelectedFields(),s.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:s}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new G({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new G({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new G({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new G({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new ee(this.getSQL(),this.config.fields,e),new G({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new G({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},an=class extends Ti{static[u]="PgSelect";_prepare(e){let{session:t,config:n,dialect:s,joinsNotNullableMap:i,authToken:o}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return F.startActiveSpan("drizzle.prepareQuery",()=>{let a=ke(n.fields),c=t.prepareQuery(s.sqlToQuery(this.getSQL()),a,e,!0);return c.joinsNotNullableMap=i,c.setToken(o)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>F.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};Lo(an,[de]);function Qt(r,e){return(t,n,...s)=>{let i=[n,...s].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of i)if(!mr(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(i)}}var $c=()=>({union:Oc,unionAll:jc,intersect:Dc,intersectAll:Lc,except:Bc,exceptAll:Rc}),Oc=Qt("union",!1),jc=Qt("union",!0),Dc=Qt("intersect",!1),Lc=Qt("intersect",!0),Bc=Qt("except",!1),Rc=Qt("except",!0);var Vt=class{static[u]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=m(e,at)?e:void 0,this.dialectConfig=m(e,at)?void 0:e}$with=(e,t)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(n)),new Proxy(new zt(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new G({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;function n(o){return new fe({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function s(o){return new fe({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function i(o,a){return new fe({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:n,selectDistinct:s,selectDistinctOn:i}}select(e){return new fe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new fe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new fe({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new at(this.dialectConfig)),this.dialect}};var Ar=class{constructor(e,t,n,s,i){this.table=e,this.session=t,this.dialect=n,this.withList=s,this.overridingSystemValue_=i}static[u]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(n=>{let s={},i=this.table[v.Symbol.Columns];for(let o of Object.keys(n)){let a=n[o];s[o]=m(a,x)?a:new xe(a,i[o])}return s});return new un(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t=typeof e=="function"?e(new Vt):e;if(!m(t,x)&&!mr(this.table[Jr],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new un(this.table,t,this.session,this.dialect,this.withList,!0)}},un=class extends de{constructor(e,t,n,s,i,o,a){super(),this.session=n,this.dialect=s,this.config={table:e,values:t,withList:i,select:o,overridingSystemValue_:a}}static[u]="PgInsert";config;returning(e=this.config.table[v.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ke(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=d`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(s=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(s))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?d` where ${e.where}`:void 0;this.config.onConflict=d`(${d.raw(t)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?d` where ${e.where}`:void 0,n=e.targetWhere?d` where ${e.targetWhere}`:void 0,s=e.setWhere?d` where ${e.setWhere}`:void 0,i=this.dialect.buildUpdateSet(this.config.table,Hr(this.config.table,e.set)),o="";return o=Array.isArray(e.target)?e.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=d`(${d.raw(o)})${n} do update set ${i}${t}${s}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return F.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>F.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new G({alias:we(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var cn=class extends de{constructor(e,t,n){super(),this.session=t,this.dialect=n,this.config={view:e}}static[u]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return F.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>F.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var Pr=class{constructor(e,t,n,s){this.table=e,this.session=t,this.dialect=n,this.withList=s}static[u]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ni(this.table,Hr(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ni=class extends de{constructor(e,t,n,s,i){super(),this.session=n,this.dialect=s,this.config={set:t,table:e,withList:i,joins:[]},this.tableName=Je(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[u]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let t=e,n=Je(t);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=t,this}getTableLikeFields(e){return m(e,ae)?e[v.Symbol.Columns]:m(e,ee)?e._.selectedFields:e[U].selectedFields}createJoin(e){return(t,n)=>{let s=Je(t);if(typeof s=="string"&&this.config.joins.some(i=>i.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(typeof n=="function"){let i=this.config.from&&!m(this.config.from,x)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[v.Symbol.Columns],new G({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),i&&new Proxy(i,new G({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:t,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([i])=>[i,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([i])=>[i,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[v.Symbol.Columns]),this.config.from)){let t=Je(this.config.from);if(typeof t=="string"&&this.config.from&&!m(this.config.from,x)){let n=this.getTableLikeFields(this.config.from);e[t]=n}for(let n of this.config.joins){let s=Je(n.table);if(typeof s=="string"&&!m(n.table,x)){let i=this.getTableLikeFields(n.table);e[s]=i}}}return this.config.returningFields=e,this.config.returning=ke(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new G({alias:we(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ln=class r extends x{constructor(e){super(r.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=r.buildCount(e.source,e.filters)}sql;token;static[u]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return d`(select count(*) from ${e}${d.raw(" where ").if(t)}${t})`}static buildCount(e,t){return d`select count(*) as count from ${e}${d.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}};var dn=class{constructor(e,t,n,s,i,o,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=s,this.tableConfig=i,this.dialect=o,this.session=a}static[u]="PgRelationalQueryBuilder";findMany(e){return new fn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new fn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},fn=class extends de{constructor(e,t,n,s,i,o,a,c,f){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=s,this.tableConfig=i,this.dialect=o,this.session=a,this.config=c,this.mode=f}static[u]="PgRelationalQuery";_prepare(e){return F.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(s,i)=>{let o=s.map(a=>sn(this.schema,this.tableConfig,a,t.selection,i));return this.mode==="first"?o[0]:o})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return F.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var mn=class extends de{constructor(e,t,n,s){super(),this.execute=e,this.sql=t,this.query=n,this.mapBatchResult=s}static[u]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Kt=class{constructor(e,t,n){if(this.dialect=e,this.session=t,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[s,i]of Object.entries(this._.schema))this.query[s]=new dn(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[s],i,e,t)}static[u]="PgDatabase";query;$with=(e,t)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(new Vt(n.dialect))),new Proxy(new zt(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new G({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new ln({source:e,filters:t,session:this.session})}with(...e){let t=this;function n(f){return new fe({fields:f??void 0,session:t.session,dialect:t.dialect,withList:e})}function s(f){return new fe({fields:f??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function i(f,l){return new fe({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:f}})}function o(f){return new Pr(f,t.session,t.dialect,e)}function a(f){return new Ar(f,t.session,t.dialect,e)}function c(f){return new _r(f,t.session,t.dialect,e)}return{select:n,selectDistinct:s,selectDistinctOn:i,update:o,insert:a,delete:c}}select(e){return new fe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new fe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new fe({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Pr(e,this.session,this.dialect)}insert(e){return new Ar(e,this.session,this.dialect)}delete(e){return new _r(e,this.session,this.dialect)}refreshMaterializedView(e){return new cn(e,this.session,this.dialect)}authToken;execute(e){let t=typeof e=="string"?d.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(t),s=this.session.prepareQuery(n,void 0,void 0,!1);return new mn(()=>s.execute(void 0,this.authToken),t,n,i=>s.mapResult(i,!0))}transaction(e,t){return this.session.transaction(e,t)}};var Ci=class{constructor(e,t){this.unique=e,this.name=t}static[u]="PgIndexBuilderOn";on(...e){return new kr(e.map(t=>{if(m(t,x))return t;t=t;let n=new Mt(t.name,!!t.keyAsName,t.columnType,t.indexConfig);return t.indexConfig=JSON.parse(JSON.stringify(t.defaultConfig)),n}),this.unique,!1,this.name)}onOnly(...e){return new kr(e.map(t=>{if(m(t,x))return t;t=t;let n=new Mt(t.name,!!t.keyAsName,t.columnType,t.indexConfig);return t.indexConfig=t.defaultConfig,n}),this.unique,!0,this.name)}using(e,...t){return new kr(t.map(n=>{if(m(n,x))return n;n=n;let s=new Mt(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),s}),this.unique,!0,this.name,e)}},kr=class{static[u]="PgIndexBuilder";config;constructor(e,t,n,s,i="btree"){this.config={name:s,columns:e,unique:t,only:n,method:i}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new Ai(this.config,e)}},Ai=class{static[u]="PgIndex";config;constructor(e,t){this.config={...e,table:t}}};function Ra(r){return new Ci(!1,r)}var pn=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[u]="PgPreparedQuery";joinsNotNullableMap},hn=class{constructor(e){this.dialect=e}static[u]="PgSession";execute(e,t){return F.startActiveSpan("drizzle.operation",()=>F.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){let n=await this.execute(e,t);return Number(n[0].count)}},gn=class extends Kt{constructor(e,t,n,s=0){super(e,t,n),this.schema=n,this.nestedIndex=s}static[u]="PgTransaction";rollback(){throw new tn}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),d.raw(t.join(" "))}setTransaction(e){return this.session.execute(d`set transaction ${this.getTransactionConfigSQL(e)}`)}};var Pi=class{static[u]="ConsoleLogWriter";write(e){console.log(e)}},yn=class{static[u]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Pi}logQuery(e,t){let n=t.map(i=>{try{return JSON.stringify(i)}catch{return String(i)}}),s=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${s}`)}},bn=class{static[u]="NoopLogger";logQuery(){}};var q={};Mn(q,{BRAND:()=>ll,DIRTY:()=>vt,EMPTY_PATH:()=>Fc,INVALID:()=>C,NEVER:()=>Zl,OK:()=>me,ParseStatus:()=>ce,Schema:()=>O,ZodAny:()=>lt,ZodArray:()=>tt,ZodBigInt:()=>xt,ZodBoolean:()=>St,ZodBranded:()=>Ir,ZodCatch:()=>Ot,ZodDate:()=>_t,ZodDefault:()=>$t,ZodDiscriminatedUnion:()=>xn,ZodEffects:()=>Oe,ZodEnum:()=>Et,ZodError:()=>_e,ZodFirstPartyTypeKind:()=>P,ZodFunction:()=>_n,ZodIntersection:()=>At,ZodIssueCode:()=>h,ZodLazy:()=>Pt,ZodLiteral:()=>kt,ZodMap:()=>Xt,ZodNaN:()=>er,ZodNativeEnum:()=>It,ZodNever:()=>De,ZodNull:()=>Nt,ZodNullable:()=>Ue,ZodNumber:()=>wt,ZodObject:()=>Te,ZodOptional:()=>Ie,ZodParsedType:()=>w,ZodPipeline:()=>$r,ZodPromise:()=>dt,ZodReadonly:()=>jt,ZodRecord:()=>Sn,ZodSchema:()=>O,ZodSet:()=>Yt,ZodString:()=>ct,ZodSymbol:()=>Ht,ZodTransformer:()=>Oe,ZodTuple:()=>Fe,ZodType:()=>O,ZodUndefined:()=>Tt,ZodUnion:()=>Ct,ZodUnknown:()=>et,ZodVoid:()=>Gt,addIssueToContext:()=>y,any:()=>vl,array:()=>_l,bigint:()=>pl,boolean:()=>Ja,coerce:()=>Wl,custom:()=>Ka,date:()=>hl,datetimeRegex:()=>Qa,defaultErrorMap:()=>Xe,discriminatedUnion:()=>Al,effect:()=>ql,enum:()=>Ll,function:()=>Ol,getErrorMap:()=>Wt,getParsedType:()=>ze,instanceof:()=>fl,intersection:()=>Pl,isAborted:()=>vn,isAsync:()=>Zt,isDirty:()=>wn,isValid:()=>ut,late:()=>dl,lazy:()=>jl,literal:()=>Dl,makeIssue:()=>Er,map:()=>Il,nan:()=>ml,nativeEnum:()=>Bl,never:()=>xl,null:()=>bl,nullable:()=>zl,number:()=>Za,object:()=>Tl,objectUtil:()=>ki,oboolean:()=>Kl,onumber:()=>Vl,optional:()=>Ml,ostring:()=>Ql,pipeline:()=>Ul,preprocess:()=>Fl,promise:()=>Rl,quotelessJson:()=>qc,record:()=>El,set:()=>$l,setErrorMap:()=>zc,strictObject:()=>Nl,string:()=>Wa,symbol:()=>gl,transformer:()=>ql,tuple:()=>kl,undefined:()=>yl,union:()=>Cl,unknown:()=>wl,util:()=>D,void:()=>Sl});var D;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let o of s)i[o]=o;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),o={};for(let a of i)o[a]=s[a];return r.objectValues(o)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},r.find=(s,i)=>{for(let o of s)if(i(o))return o},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(D||(D={}));var ki;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(ki||(ki={}));var w=D.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ze=r=>{switch(typeof r){case"undefined":return w.undefined;case"string":return w.string;case"number":return Number.isNaN(r)?w.nan:w.number;case"boolean":return w.boolean;case"function":return w.function;case"bigint":return w.bigint;case"symbol":return w.symbol;case"object":return Array.isArray(r)?w.array:r===null?w.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?w.promise:typeof Map<"u"&&r instanceof Map?w.map:typeof Set<"u"&&r instanceof Set?w.set:typeof Date<"u"&&r instanceof Date?w.date:w.object;default:return w.unknown}};var h=D.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),qc=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),_e=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let a=n,c=0;for(;c<o.path.length;){let f=o.path[c];c===o.path.length-1?(a[f]=a[f]||{_errors:[]},a[f]._errors.push(t(o))):a[f]=a[f]||{_errors:[]},a=a[f],c++}}};return s(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,D.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)if(s.path.length>0){let i=s.path[0];t[i]=t[i]||[],t[i].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};_e.create=r=>new _e(r);var Mc=(r,e)=>{let t;switch(r.code){case h.invalid_type:r.received===w.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case h.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,D.jsonStringifyReplacer)}`;break;case h.unrecognized_keys:t=`Unrecognized key(s) in object: ${D.joinValues(r.keys,", ")}`;break;case h.invalid_union:t="Invalid input";break;case h.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${D.joinValues(r.options)}`;break;case h.invalid_enum_value:t=`Invalid enum value. Expected ${D.joinValues(r.options)}, received '${r.received}'`;break;case h.invalid_arguments:t="Invalid function arguments";break;case h.invalid_return_type:t="Invalid function return type";break;case h.invalid_date:t="Invalid date";break;case h.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:D.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case h.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case h.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case h.custom:t="Invalid input";break;case h.invalid_intersection_types:t="Intersection results could not be merged";break;case h.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case h.not_finite:t="Number must be finite";break;default:t=e.defaultError,D.assertNever(r)}return{message:t}},Xe=Mc;var qa=Xe;function zc(r){qa=r}function Wt(){return qa}var Er=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],o={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let a="",c=n.filter(f=>!!f).slice().reverse();for(let f of c)a=f(o,{data:e,defaultError:a}).message;return{...s,path:i,message:a}},Fc=[];function y(r,e){let t=Wt(),n=Er({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Xe?void 0:Xe].filter(s=>!!s)});r.common.issues.push(n)}var ce=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return C;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t){let i=await s.key,o=await s.value;n.push({key:i,value:o})}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return C;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(n[i.value]=o.value)}return{status:e.value,value:n}}},C=Object.freeze({status:"aborted"}),vt=r=>({status:"dirty",value:r}),me=r=>({status:"valid",value:r}),vn=r=>r.status==="aborted",wn=r=>r.status==="dirty",ut=r=>r.status==="valid",Zt=r=>typeof Promise<"u"&&r instanceof Promise;var T;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(T||(T={}));var $e=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ma=(r,e)=>{if(ut(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new _e(r.common.issues);return this._error=t,this._error}}};function $(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,a)=>{let{message:c}=r;return o.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:c??t??a.defaultError}},description:s}}var O=class{get description(){return this._def.description}_getType(e){return ze(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ze(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ce,ctx:{common:e.parent.common,data:e.data,parsedType:ze(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Zt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ze(e)},s=this._parseSync({data:e,path:n.path,parent:n});return Ma(n,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ze(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return ut(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>ut(n)?{value:n.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ze(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(Zt(s)?s:Promise.resolve(s));return Ma(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let o=e(s),a=()=>i.addIssue({code:h.custom,...n(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Oe({schema:this,typeName:P.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Ie.create(this,this._def)}nullable(){return Ue.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return tt.create(this)}promise(){return dt.create(this,this._def)}or(e){return Ct.create([this,e],this._def)}and(e){return At.create(this,e,this._def)}transform(e){return new Oe({...$(this._def),schema:this,typeName:P.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new $t({...$(this._def),innerType:this,defaultValue:t,typeName:P.ZodDefault})}brand(){return new Ir({typeName:P.ZodBranded,type:this,...$(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Ot({...$(this._def),innerType:this,catchValue:t,typeName:P.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return $r.create(this,e)}readonly(){return jt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Uc=/^c[^\s-]{8,}$/i,Qc=/^[0-9a-z]+$/,Vc=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Kc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Wc=/^[a-z0-9_-]{21}$/i,Zc=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Jc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Hc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Gc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ei,Xc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Yc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,el=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,tl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,rl=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nl=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Fa="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sl=new RegExp(`^${Fa}$`);function Ua(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function il(r){return new RegExp(`^${Ua(r)}$`)}function Qa(r){let e=`${Fa}T${Ua(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function ol(r,e){return!!((e==="v4"||!e)&&Xc.test(r)||(e==="v6"||!e)&&el.test(r))}function al(r,e){if(!Zc.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function ul(r,e){return!!((e==="v4"||!e)&&Yc.test(r)||(e==="v6"||!e)&&tl.test(r))}var ct=class r extends O{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==w.string){let i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_type,expected:w.string,received:i.parsedType}),C}let n=new ce,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(s=this._getOrReturnCtx(e,s),o?y(s,{code:h.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&y(s,{code:h.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")Hc.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"email",code:h.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Ei||(Ei=new RegExp(Gc,"u")),Ei.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"emoji",code:h.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")Kc.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"uuid",code:h.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")Wc.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"nanoid",code:h.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")Uc.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"cuid",code:h.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")Qc.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"cuid2",code:h.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")Vc.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"ulid",code:h.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),y(s,{validation:"url",code:h.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"regex",code:h.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?Qa(i).test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?sl.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?il(i).test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?Jc.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"duration",code:h.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?ol(e.data,i.version)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"ip",code:h.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?al(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"jwt",code:h.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?ul(e.data,i.version)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"cidr",code:h.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?rl.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"base64",code:h.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?nl.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"base64url",code:h.invalid_string,message:i.message}),n.dirty()):D.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:h.invalid_string,...T.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...T.errToObj(e)})}url(e){return this._addCheck({kind:"url",...T.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...T.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...T.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...T.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...T.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...T.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...T.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...T.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...T.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...T.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...T.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...T.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...T.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...T.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...T.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...T.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...T.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...T.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...T.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...T.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...T.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...T.errToObj(t)})}nonempty(e){return this.min(1,T.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};ct.create=r=>new ct({checks:[],typeName:P.ZodString,coerce:r?.coerce??!1,...$(r)});function cl(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=Number.parseInt(r.toFixed(s).replace(".","")),o=Number.parseInt(e.toFixed(s).replace(".",""));return i%o/10**s}var wt=class r extends O{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==w.number){let i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_type,expected:w.number,received:i.parsedType}),C}let n,s=new ce;for(let i of this._def.checks)i.kind==="int"?D.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:h.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:h.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:h.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?cl(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),y(n,{code:h.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:h.not_finite,message:i.message}),s.dirty()):D.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,T.toString(t))}gt(e,t){return this.setLimit("min",e,!1,T.toString(t))}lte(e,t){return this.setLimit("max",e,!0,T.toString(t))}lt(e,t){return this.setLimit("max",e,!1,T.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:T.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:T.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:T.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:T.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:T.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&D.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};wt.create=r=>new wt({checks:[],typeName:P.ZodNumber,coerce:r?.coerce||!1,...$(r)});var xt=class r extends O{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==w.bigint)return this._getInvalidInput(e);let n,s=new ce;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:h.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:h.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),y(n,{code:h.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):D.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return y(t,{code:h.invalid_type,expected:w.bigint,received:t.parsedType}),C}gte(e,t){return this.setLimit("min",e,!0,T.toString(t))}gt(e,t){return this.setLimit("min",e,!1,T.toString(t))}lte(e,t){return this.setLimit("max",e,!0,T.toString(t))}lt(e,t){return this.setLimit("max",e,!1,T.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:T.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};xt.create=r=>new xt({checks:[],typeName:P.ZodBigInt,coerce:r?.coerce??!1,...$(r)});var St=class extends O{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==w.boolean){let n=this._getOrReturnCtx(e);return y(n,{code:h.invalid_type,expected:w.boolean,received:n.parsedType}),C}return me(e.data)}};St.create=r=>new St({typeName:P.ZodBoolean,coerce:r?.coerce||!1,...$(r)});var _t=class r extends O{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==w.date){let i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_type,expected:w.date,received:i.parsedType}),C}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_date}),C}let n=new ce,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):D.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:T.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:T.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};_t.create=r=>new _t({checks:[],coerce:r?.coerce||!1,typeName:P.ZodDate,...$(r)});var Ht=class extends O{_parse(e){if(this._getType(e)!==w.symbol){let n=this._getOrReturnCtx(e);return y(n,{code:h.invalid_type,expected:w.symbol,received:n.parsedType}),C}return me(e.data)}};Ht.create=r=>new Ht({typeName:P.ZodSymbol,...$(r)});var Tt=class extends O{_parse(e){if(this._getType(e)!==w.undefined){let n=this._getOrReturnCtx(e);return y(n,{code:h.invalid_type,expected:w.undefined,received:n.parsedType}),C}return me(e.data)}};Tt.create=r=>new Tt({typeName:P.ZodUndefined,...$(r)});var Nt=class extends O{_parse(e){if(this._getType(e)!==w.null){let n=this._getOrReturnCtx(e);return y(n,{code:h.invalid_type,expected:w.null,received:n.parsedType}),C}return me(e.data)}};Nt.create=r=>new Nt({typeName:P.ZodNull,...$(r)});var lt=class extends O{constructor(){super(...arguments),this._any=!0}_parse(e){return me(e.data)}};lt.create=r=>new lt({typeName:P.ZodAny,...$(r)});var et=class extends O{constructor(){super(...arguments),this._unknown=!0}_parse(e){return me(e.data)}};et.create=r=>new et({typeName:P.ZodUnknown,...$(r)});var De=class extends O{_parse(e){let t=this._getOrReturnCtx(e);return y(t,{code:h.invalid_type,expected:w.never,received:t.parsedType}),C}};De.create=r=>new De({typeName:P.ZodNever,...$(r)});var Gt=class extends O{_parse(e){if(this._getType(e)!==w.undefined){let n=this._getOrReturnCtx(e);return y(n,{code:h.invalid_type,expected:w.void,received:n.parsedType}),C}return me(e.data)}};Gt.create=r=>new Gt({typeName:P.ZodVoid,...$(r)});var tt=class r extends O{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==w.array)return y(t,{code:h.invalid_type,expected:w.array,received:t.parsedType}),C;if(s.exactLength!==null){let o=t.data.length>s.exactLength.value,a=t.data.length<s.exactLength.value;(o||a)&&(y(t,{code:o?h.too_big:h.too_small,minimum:a?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(y(t,{code:h.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(y(t,{code:h.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>s.type._parseAsync(new $e(t,o,t.path,a)))).then(o=>ce.mergeArray(n,o));let i=[...t.data].map((o,a)=>s.type._parseSync(new $e(t,o,t.path,a)));return ce.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:T.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:T.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:T.toString(t)}})}nonempty(e){return this.min(1,e)}};tt.create=(r,e)=>new tt({type:r,minLength:null,maxLength:null,exactLength:null,typeName:P.ZodArray,...$(e)});function Jt(r){if(r instanceof Te){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=Ie.create(Jt(n))}return new Te({...r._def,shape:()=>e})}else return r instanceof tt?new tt({...r._def,type:Jt(r.element)}):r instanceof Ie?Ie.create(Jt(r.unwrap())):r instanceof Ue?Ue.create(Jt(r.unwrap())):r instanceof Fe?Fe.create(r.items.map(e=>Jt(e))):r}var Te=class r extends O{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=D.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==w.object){let f=this._getOrReturnCtx(e);return y(f,{code:h.invalid_type,expected:w.object,received:f.parsedType}),C}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof De&&this._def.unknownKeys==="strip"))for(let f in s.data)o.includes(f)||a.push(f);let c=[];for(let f of o){let l=i[f],p=s.data[f];c.push({key:{status:"valid",value:f},value:l._parse(new $e(s,p,s.path,f)),alwaysSet:f in s.data})}if(this._def.catchall instanceof De){let f=this._def.unknownKeys;if(f==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(f==="strict")a.length>0&&(y(s,{code:h.unrecognized_keys,keys:a}),n.dirty());else if(f!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let f=this._def.catchall;for(let l of a){let p=s.data[l];c.push({key:{status:"valid",value:l},value:f._parse(new $e(s,p,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let f=[];for(let l of c){let p=await l.key,b=await l.value;f.push({key:p,value:b,alwaysSet:l.alwaysSet})}return f}).then(f=>ce.mergeObjectSync(n,f)):ce.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return T.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{let s=this._def.errorMap?.(t,n).message??n.defaultError;return t.code==="unrecognized_keys"?{message:T.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:P.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let n of D.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let n of D.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}deepPartial(){return Jt(this)}partial(e){let t={};for(let n of D.objectKeys(this.shape)){let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let n of D.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof Ie;)i=i._def.innerType;t[n]=i}return new r({...this._def,shape:()=>t})}keyof(){return Va(D.objectKeys(this.shape))}};Te.create=(r,e)=>new Te({shape:()=>r,unknownKeys:"strip",catchall:De.create(),typeName:P.ZodObject,...$(e)});Te.strictCreate=(r,e)=>new Te({shape:()=>r,unknownKeys:"strict",catchall:De.create(),typeName:P.ZodObject,...$(e)});Te.lazycreate=(r,e)=>new Te({shape:r,unknownKeys:"strip",catchall:De.create(),typeName:P.ZodObject,...$(e)});var Ct=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(a=>new _e(a.ctx.common.issues));return y(t,{code:h.invalid_union,unionErrors:o}),C}if(t.common.async)return Promise.all(n.map(async i=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(s);{let i,o=[];for(let c of n){let f={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:f});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:f}),f.common.issues.length&&o.push(f.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let a=o.map(c=>new _e(c));return y(t,{code:h.invalid_union,unionErrors:a}),C}}get options(){return this._def.options}};Ct.create=(r,e)=>new Ct({options:r,typeName:P.ZodUnion,...$(e)});var Ye=r=>r instanceof Pt?Ye(r.schema):r instanceof Oe?Ye(r.innerType()):r instanceof kt?[r.value]:r instanceof Et?r.options:r instanceof It?D.objectValues(r.enum):r instanceof $t?Ye(r._def.innerType):r instanceof Tt?[void 0]:r instanceof Nt?[null]:r instanceof Ie?[void 0,...Ye(r.unwrap())]:r instanceof Ue?[null,...Ye(r.unwrap())]:r instanceof Ir||r instanceof jt?Ye(r.unwrap()):r instanceof Ot?Ye(r._def.innerType):[],xn=class r extends O{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==w.object)return y(t,{code:h.invalid_type,expected:w.object,received:t.parsedType}),C;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(y(t,{code:h.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),C)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let o=Ye(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(s.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);s.set(a,i)}}return new r({typeName:P.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...$(n)})}};function Ii(r,e){let t=ze(r),n=ze(e);if(r===e)return{valid:!0,data:r};if(t===w.object&&n===w.object){let s=D.objectKeys(e),i=D.objectKeys(r).filter(a=>s.indexOf(a)!==-1),o={...r,...e};for(let a of i){let c=Ii(r[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===w.array&&n===w.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let o=r[i],a=e[i],c=Ii(o,a);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===w.date&&n===w.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var At=class extends O{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,o)=>{if(vn(i)||vn(o))return C;let a=Ii(i.value,o.value);return a.valid?((wn(i)||wn(o))&&t.dirty(),{status:t.value,value:a.data}):(y(n,{code:h.invalid_intersection_types}),C)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};At.create=(r,e,t)=>new At({left:r,right:e,typeName:P.ZodIntersection,...$(t)});var Fe=class r extends O{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.array)return y(n,{code:h.invalid_type,expected:w.array,received:n.parsedType}),C;if(n.data.length<this._def.items.length)return y(n,{code:h.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),C;!this._def.rest&&n.data.length>this._def.items.length&&(y(n,{code:h.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((o,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new $e(n,o,n.path,a)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>ce.mergeArray(t,o)):ce.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Fe.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Fe({items:r,typeName:P.ZodTuple,rest:null,...$(e)})};var Sn=class r extends O{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.object)return y(n,{code:h.invalid_type,expected:w.object,received:n.parsedType}),C;let s=[],i=this._def.keyType,o=this._def.valueType;for(let a in n.data)s.push({key:i._parse(new $e(n,a,n.path,a)),value:o._parse(new $e(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?ce.mergeObjectAsync(t,s):ce.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof O?new r({keyType:e,valueType:t,typeName:P.ZodRecord,...$(n)}):new r({keyType:ct.create(),valueType:e,typeName:P.ZodRecord,...$(t)})}},Xt=class extends O{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.map)return y(n,{code:h.invalid_type,expected:w.map,received:n.parsedType}),C;let s=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([a,c],f)=>({key:s._parse(new $e(n,a,n.path,[f,"key"])),value:i._parse(new $e(n,c,n.path,[f,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of o){let f=await c.key,l=await c.value;if(f.status==="aborted"||l.status==="aborted")return C;(f.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(f.value,l.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let c of o){let f=c.key,l=c.value;if(f.status==="aborted"||l.status==="aborted")return C;(f.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(f.value,l.value)}return{status:t.value,value:a}}}};Xt.create=(r,e,t)=>new Xt({valueType:e,keyType:r,typeName:P.ZodMap,...$(t)});var Yt=class r extends O{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==w.set)return y(n,{code:h.invalid_type,expected:w.set,received:n.parsedType}),C;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(y(n,{code:h.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(y(n,{code:h.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function o(c){let f=new Set;for(let l of c){if(l.status==="aborted")return C;l.status==="dirty"&&t.dirty(),f.add(l.value)}return{status:t.value,value:f}}let a=[...n.data.values()].map((c,f)=>i._parse(new $e(n,c,n.path,f)));return n.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new r({...this._def,minSize:{value:e,message:T.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:T.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Yt.create=(r,e)=>new Yt({valueType:r,minSize:null,maxSize:null,typeName:P.ZodSet,...$(e)});var _n=class r extends O{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==w.function)return y(t,{code:h.invalid_type,expected:w.function,received:t.parsedType}),C;function n(a,c){return Er({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Wt(),Xe].filter(f=>!!f),issueData:{code:h.invalid_arguments,argumentsError:c}})}function s(a,c){return Er({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Wt(),Xe].filter(f=>!!f),issueData:{code:h.invalid_return_type,returnTypeError:c}})}let i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof dt){let a=this;return me(async function(...c){let f=new _e([]),l=await a._def.args.parseAsync(c,i).catch(A=>{throw f.addIssue(n(c,A)),f}),p=await Reflect.apply(o,this,l);return await a._def.returns._def.type.parseAsync(p,i).catch(A=>{throw f.addIssue(s(p,A)),f})})}else{let a=this;return me(function(...c){let f=a._def.args.safeParse(c,i);if(!f.success)throw new _e([n(c,f.error)]);let l=Reflect.apply(o,this,f.data),p=a._def.returns.safeParse(l,i);if(!p.success)throw new _e([s(l,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Fe.create(e).rest(et.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||Fe.create([]).rest(et.create()),returns:t||et.create(),typeName:P.ZodFunction,...$(n)})}},Pt=class extends O{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Pt.create=(r,e)=>new Pt({getter:r,typeName:P.ZodLazy,...$(e)});var kt=class extends O{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return y(t,{received:t.data,code:h.invalid_literal,expected:this._def.value}),C}return{status:"valid",value:e.data}}get value(){return this._def.value}};kt.create=(r,e)=>new kt({value:r,typeName:P.ZodLiteral,...$(e)});function Va(r,e){return new Et({values:r,typeName:P.ZodEnum,...$(e)})}var Et=class r extends O{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return y(t,{expected:D.joinValues(n),received:t.parsedType,code:h.invalid_type}),C}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return y(t,{received:t.data,code:h.invalid_enum_value,options:n}),C}return me(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};Et.create=Va;var It=class extends O{_parse(e){let t=D.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==w.string&&n.parsedType!==w.number){let s=D.objectValues(t);return y(n,{expected:D.joinValues(s),received:n.parsedType,code:h.invalid_type}),C}if(this._cache||(this._cache=new Set(D.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=D.objectValues(t);return y(n,{received:n.data,code:h.invalid_enum_value,options:s}),C}return me(e.data)}get enum(){return this._def.values}};It.create=(r,e)=>new It({values:r,typeName:P.ZodNativeEnum,...$(e)});var dt=class extends O{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==w.promise&&t.common.async===!1)return y(t,{code:h.invalid_type,expected:w.promise,received:t.parsedType}),C;let n=t.parsedType===w.promise?t.data:Promise.resolve(t.data);return me(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};dt.create=(r,e)=>new dt({type:r,typeName:P.ZodPromise,...$(e)});var Oe=class extends O{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===P.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{y(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let o=s.transform(n.data,i);if(n.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return C;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?C:c.status==="dirty"?vt(c.value):t.value==="dirty"?vt(c.value):c});{if(t.value==="aborted")return C;let a=this._def.schema._parseSync({data:o,path:n.path,parent:n});return a.status==="aborted"?C:a.status==="dirty"?vt(a.value):t.value==="dirty"?vt(a.value):a}}if(s.type==="refinement"){let o=a=>{let c=s.refinement(a,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?C:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?C:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(s.type==="transform")if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!ut(o))return C;let a=s.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>ut(o)?Promise.resolve(s.transform(o.value,i)).then(a=>({status:t.value,value:a})):C);D.assertNever(s)}};Oe.create=(r,e,t)=>new Oe({schema:r,typeName:P.ZodEffects,effect:e,...$(t)});Oe.createWithPreprocess=(r,e,t)=>new Oe({schema:e,effect:{type:"preprocess",transform:r},typeName:P.ZodEffects,...$(t)});var Ie=class extends O{_parse(e){return this._getType(e)===w.undefined?me(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ie.create=(r,e)=>new Ie({innerType:r,typeName:P.ZodOptional,...$(e)});var Ue=class extends O{_parse(e){return this._getType(e)===w.null?me(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ue.create=(r,e)=>new Ue({innerType:r,typeName:P.ZodNullable,...$(e)});var $t=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===w.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};$t.create=(r,e)=>new $t({innerType:r,typeName:P.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...$(e)});var Ot=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Zt(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new _e(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new _e(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ot.create=(r,e)=>new Ot({innerType:r,typeName:P.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...$(e)});var er=class extends O{_parse(e){if(this._getType(e)!==w.nan){let n=this._getOrReturnCtx(e);return y(n,{code:h.invalid_type,expected:w.nan,received:n.parsedType}),C}return{status:"valid",value:e.data}}};er.create=r=>new er({typeName:P.ZodNaN,...$(r)});var ll=Symbol("zod_brand"),Ir=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},$r=class r extends O{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?C:i.status==="dirty"?(t.dirty(),vt(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?C:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:P.ZodPipeline})}},jt=class extends O{_parse(e){let t=this._def.innerType._parse(e),n=s=>(ut(s)&&(s.value=Object.freeze(s.value)),s);return Zt(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}};jt.create=(r,e)=>new jt({innerType:r,typeName:P.ZodReadonly,...$(e)});function za(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Ka(r,e={},t){return r?lt.create().superRefine((n,s)=>{let i=r(n);if(i instanceof Promise)return i.then(o=>{if(!o){let a=za(e,n),c=a.fatal??t??!0;s.addIssue({code:"custom",...a,fatal:c})}});if(!i){let o=za(e,n),a=o.fatal??t??!0;s.addIssue({code:"custom",...o,fatal:a})}}):lt.create()}var dl={object:Te.lazycreate},P;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(P||(P={}));var fl=(r,e={message:`Input not instance of ${r.name}`})=>Ka(t=>t instanceof r,e),Wa=ct.create,Za=wt.create,ml=er.create,pl=xt.create,Ja=St.create,hl=_t.create,gl=Ht.create,yl=Tt.create,bl=Nt.create,vl=lt.create,wl=et.create,xl=De.create,Sl=Gt.create,_l=tt.create,Tl=Te.create,Nl=Te.strictCreate,Cl=Ct.create,Al=xn.create,Pl=At.create,kl=Fe.create,El=Sn.create,Il=Xt.create,$l=Yt.create,Ol=_n.create,jl=Pt.create,Dl=kt.create,Ll=Et.create,Bl=It.create,Rl=dt.create,ql=Oe.create,Ml=Ie.create,zl=Ue.create,Fl=Oe.createWithPreprocess,Ul=$r.create,Ql=()=>Wa().optional(),Vl=()=>Za().optional(),Kl=()=>Ja().optional(),Wl={string:(r=>ct.create({...r,coerce:!0})),number:(r=>wt.create({...r,coerce:!0})),boolean:(r=>St.create({...r,coerce:!0})),bigint:(r=>xt.create({...r,coerce:!0})),date:(r=>_t.create({...r,coerce:!0}))};var Zl=C;var J={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function Y(r,e){return e.includes(r.columnType)}function Ha(r){return"enumValues"in r&&Array.isArray(r.enumValues)&&r.enumValues.length>0}var Jl=Ha,Hl=q.union([q.string(),q.number(),q.boolean(),q.null()]),Gl=q.union([Hl,q.record(q.any()),q.array(q.any())]),Xl=q.custom(r=>r instanceof Buffer);function Ga(r,e){let t=e?.zodInstance??q,n=e?.coerce??{},s;return Ha(r)&&(s=r.enumValues.length?t.enum(r.enumValues):t.string()),s||(Y(r,["PgGeometry","PgPointTuple"])?s=t.tuple([t.number(),t.number()]):Y(r,["PgGeometryObject","PgPointObject"])?s=t.object({x:t.number(),y:t.number()}):Y(r,["PgHalfVector","PgVector"])?(s=t.array(t.number()),s=r.dimensions?s.length(r.dimensions):s):Y(r,["PgLine"])?s=t.tuple([t.number(),t.number(),t.number()]):Y(r,["PgLineABC"])?s=t.object({a:t.number(),b:t.number(),c:t.number()}):Y(r,["PgArray"])?(s=t.array(Ga(r.baseColumn,t)),s=r.size?s.length(r.size):s):r.dataType==="array"?s=t.array(t.any()):r.dataType==="number"?s=Yl(r,t,n):r.dataType==="bigint"?s=ed(r,t,n):r.dataType==="boolean"?s=n===!0||n.boolean?t.coerce.boolean():t.boolean():r.dataType==="date"?s=n===!0||n.date?t.coerce.date():t.date():r.dataType==="string"?s=td(r,t,n):r.dataType==="json"?s=Gl:r.dataType==="custom"?s=t.any():r.dataType==="buffer"&&(s=Xl)),s||(s=t.any()),s}function Yl(r,e,t){let n=r.getSQLType().includes("unsigned"),s,i,o=!1;Y(r,["MySqlTinyInt","SingleStoreTinyInt"])?(s=n?0:J.INT8_MIN,i=n?J.INT8_UNSIGNED_MAX:J.INT8_MAX,o=!0):Y(r,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(s=n?0:J.INT16_MIN,i=n?J.INT16_UNSIGNED_MAX:J.INT16_MAX,o=!0):Y(r,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(s=n?0:J.INT24_MIN,i=n?J.INT24_UNSIGNED_MAX:J.INT24_MAX,o=Y(r,["MySqlMediumInt","SingleStoreMediumInt"])):Y(r,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(s=n?0:J.INT32_MIN,i=n?J.INT32_UNSIGNED_MAX:J.INT32_MAX,o=!0):Y(r,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(s=n?0:J.INT48_MIN,i=n?J.INT48_UNSIGNED_MAX:J.INT48_MAX):Y(r,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||Y(r,["MySqlSerial","SingleStoreSerial"]),s=n?0:Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=!0):Y(r,["MySqlYear","SingleStoreYear"])?(s=1901,i=2155,o=!0):(s=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER);let a=t===!0||t?.number?e.coerce.number():e.number();return a=a.min(s).max(i),o?a.int():a}function ed(r,e,t){let n=r.getSQLType().includes("unsigned"),s=n?0n:J.INT64_MIN,i=n?J.INT64_UNSIGNED_MAX:J.INT64_MAX;return(t===!0||t?.bigint?e.coerce.bigint():e.bigint()).min(s).max(i)}function td(r,e,t){if(Y(r,["PgUUID"]))return e.string().uuid();let n,s,i=!1;Y(r,["PgVarchar","SQLiteText"])?n=r.length:Y(r,["MySqlVarChar","SingleStoreVarChar"])?n=r.length??J.INT16_UNSIGNED_MAX:Y(r,["MySqlText","SingleStoreText"])&&(r.textType==="longtext"?n=J.INT32_UNSIGNED_MAX:r.textType==="mediumtext"?n=J.INT24_UNSIGNED_MAX:r.textType==="text"?n=J.INT16_UNSIGNED_MAX:n=J.INT8_UNSIGNED_MAX),Y(r,["PgChar","MySqlChar","SingleStoreChar"])&&(n=r.length,i=!0),Y(r,["PgBinaryVector"])&&(s=/^[01]+$/,n=r.dimensions);let o=t===!0||t?.string?e.coerce.string():e.string();return o=s?o.regex(s):o,n&&i?o.length(n):n?o.max(n):o}function $i(r){return es(r)?Gr(r):Bo(r)}function Oi(r,e,t,n){let s={};for(let[i,o]of Object.entries(r)){if(!m(o,M)&&!m(o,x)&&!m(o,x.Aliased)&&typeof o=="object"){let p=es(o)||Oo(o)?$i(o):o;s[i]=Oi(p,e[i]??{},t,n);continue}let a=e[i];if(a!==void 0&&typeof a!="function"){s[i]=a;continue}let c=m(o,M)?o:void 0,f=c?Ga(c,n):q.any(),l=typeof a=="function"?a(f):f;t.never(c)||(s[i]=l,c&&(t.nullable(c)&&(s[i]=s[i].nullable()),t.optional(c)&&(s[i]=s[i].optional())))}return q.object(s)}function rd(r,e){return(e?.zodInstance??q).enum(r.enumValues)}var nd={never:()=>!1,optional:()=>!1,nullable:r=>!r.notNull},sd={never:r=>r?.generated?.type==="always"||r?.generatedIdentity?.type==="always",optional:r=>!r.notNull||r.notNull&&r.hasDefault,nullable:r=>!r.notNull};var ji=(r,e)=>{if(Jl(r))return rd(r);let t=$i(r);return Oi(t,e??{},nd)},Or=(r,e)=>{let t=$i(r);return Oi(t,e??{},sd)};var id=it("sessions",{sid:Ee("sid").primaryKey(),sess:Yr("sess").notNull(),expire:le("expire").notNull()},r=>[Ra("IDX_session_expire").on(r.expire)]),se=it("users",{id:Ee("id").primaryKey().default(d`gen_random_uuid()`),email:Ee("email").unique(),firstName:Ee("first_name"),lastName:Ee("last_name"),profileImageUrl:Ee("profile_image_url"),orgName:Ee("org_name"),orgSlug:Ee("org_slug").unique(),orgLogoUrl:N("org_logo_url"),orgWebsite:N("org_website"),orgDescription:N("org_description"),isOnboarded:Xr("is_onboarded").default(!1),role:Ee("role").default("admin"),createdAt:le("created_at").defaultNow(),updatedAt:le("updated_at").defaultNow()});var od=["PMR","Casino","Sportsbook"],ad=["Florida","New Jersey","Michigan"],H=it("briefs",{id:yt("id").primaryKey(),slug:N("slug").notNull().unique(),title:N("title").notNull(),orgName:N("org_name").notNull(),businessLine:N("business_line").notNull().default("Sportsbook"),state:N("state").notNull().default("Florida"),overview:N("overview").notNull(),requirements:N("requirements").array().notNull(),deliverableRatio:N("deliverable_ratio").notNull(),deliverableLength:N("deliverable_length").notNull(),deliverableFormat:N("deliverable_format").notNull(),rewardType:N("reward_type").notNull(),rewardAmount:N("reward_amount").notNull(),rewardCurrency:N("reward_currency").default("USD"),rewardDescription:N("reward_description"),deadline:le("deadline").notNull(),status:N("status").notNull().default("DRAFT"),password:N("password"),maxWinners:Ge("max_winners").default(1),maxSubmissionsPerCreator:Ge("max_submissions_per_creator").default(3),ownerId:N("owner_id").notNull(),createdAt:le("created_at").defaultNow().notNull(),updatedAt:le("updated_at").defaultNow().notNull()}),Di=Or(H,{requirements:q.array(q.string().min(1)),rewardType:q.enum(["CASH","BONUS_BETS","OTHER"]),businessLine:q.enum(["PMR","Casino","Sportsbook"]).default("Sportsbook"),state:q.enum(["Florida","New Jersey","Michigan"]).default("Florida"),status:q.enum(["DRAFT","PUBLISHED","ARCHIVED"]).default("DRAFT")}).omit({id:!0,createdAt:!0,updatedAt:!0}),ud=ji(H),pe=it("submissions",{id:yt("id").primaryKey(),briefId:Ge("brief_id").notNull().references(()=>H.id),creatorId:N("creator_id"),creatorName:N("creator_name").notNull(),creatorEmail:N("creator_email").notNull(),creatorPhone:N("creator_phone"),creatorHandle:N("creator_handle").notNull(),creatorBettingAccount:N("creator_betting_account"),message:N("message"),videoUrl:N("video_url").notNull(),videoFileName:N("video_file_name").notNull(),videoMimeType:N("video_mime_type").notNull(),videoSizeBytes:Ge("video_size_bytes").notNull(),status:N("status").notNull().default("RECEIVED"),payoutStatus:N("payout_status").notNull().default("NOT_APPLICABLE"),payoutAmount:Xo("payout_amount"),payoutNotes:N("payout_notes"),reviewedBy:N("reviewed_by"),reviewNotes:N("review_notes"),selectedAt:le("selected_at"),paidAt:le("paid_at"),submittedAt:le("submitted_at").defaultNow().notNull()}),Li=Or(pe,{status:q.enum(["RECEIVED","IN_REVIEW","SELECTED","NOT_SELECTED"]).default("RECEIVED"),payoutStatus:q.enum(["NOT_APPLICABLE","PENDING","PAID"]).default("NOT_APPLICABLE")}).omit({id:!0,submittedAt:!0,selectedAt:!0,paidAt:!0}),cd=ji(pe),Xa=it("reviewers",{id:yt("id").primaryKey(),briefId:Ge("brief_id").notNull().references(()=>H.id),userId:N("user_id").notNull(),invitedBy:N("invited_by").notNull(),canSelect:Ge("can_select").default(1),createdAt:le("created_at").defaultNow().notNull()}),ld=Or(Xa).omit({id:!0,createdAt:!0}),Ae=it("prompt_templates",{id:yt("id").primaryKey(),ownerId:N("owner_id").notNull(),name:N("name").notNull(),overview:N("overview"),requirements:N("requirements").array(),deliverableRatio:N("deliverable_ratio"),deliverableLength:N("deliverable_length"),deliverableFormat:N("deliverable_format"),rewardType:N("reward_type"),rewardAmount:N("reward_amount"),rewardCurrency:N("reward_currency"),rewardDescription:N("reward_description"),createdAt:le("created_at").defaultNow().notNull(),updatedAt:le("updated_at").defaultNow().notNull()}),Bi=Or(Ae).omit({id:!0,createdAt:!0,updatedAt:!0});var Nn=Pe(require("pg"),1);var eu=Pe(require("pg"),1);var{Pool:Ya,types:Qe}=eu.default,qi=class extends pn{constructor(e,t,n,s,i,o,a,c){super({sql:t,params:n}),this.client=e,this.params=n,this.logger=s,this.fields=i,this._isResponseInArrayMode=a,this.customResultMapper=c,this.rawQueryConfig={name:o,text:t,types:{getTypeParser:(f,l)=>f===Qe.builtins.TIMESTAMPTZ?p=>p:f===Qe.builtins.TIMESTAMP?p=>p:f===Qe.builtins.DATE?p=>p:f===Qe.builtins.INTERVAL?p=>p:Qe.getTypeParser(f,l)}},this.queryConfig={name:o,text:t,rowMode:"array",types:{getTypeParser:(f,l)=>f===Qe.builtins.TIMESTAMPTZ?p=>p:f===Qe.builtins.TIMESTAMP?p=>p:f===Qe.builtins.DATE?p=>p:f===Qe.builtins.INTERVAL?p=>p:Qe.getTypeParser(f,l)}}}static[u]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return F.startActiveSpan("drizzle.execute",async()=>{let t=rs(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,t);let{fields:n,rawQueryConfig:s,client:i,queryConfig:o,joinsNotNullableMap:a,customResultMapper:c}=this;if(!n&&!c)return F.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(t)}),i.query(s,t)));let f=await F.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":o.name,"drizzle.query.text":o.text,"drizzle.query.params":JSON.stringify(t)}),i.query(o,t)));return F.startActiveSpan("drizzle.mapResponse",()=>c?c(f.rows):f.rows.map(l=>Do(n,l,a)))})}all(e={}){return F.startActiveSpan("drizzle.execute",()=>{let t=rs(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,t),F.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(t)}),this.client.query(this.rawQueryConfig,t).then(s=>s.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},Tn=class r extends hn{constructor(e,t,n,s={}){super(t),this.client=e,this.schema=n,this.options=s,this.logger=s.logger??new bn}static[u]="NodePgSession";logger;prepareQuery(e,t,n,s,i){return new qi(this.client,e.sql,e.params,this.logger,t,n,s,i)}async transaction(e,t){let n=this.client instanceof Ya?new r(await this.client.connect(),this.dialect,this.schema,this.options):this,s=new Mi(this.dialect,n,this.schema);await s.execute(d`begin${t?d` ${s.getTransactionConfigSQL(t)}`:void 0}`);try{let i=await e(s);return await s.execute(d`commit`),i}catch(i){throw await s.execute(d`rollback`),i}finally{this.client instanceof Ya&&n.client.release()}}async count(e){let t=await this.execute(e);return Number(t.rows[0].count)}},Mi=class r extends gn{static[u]="NodePgTransaction";async transaction(e){let t=`sp${this.nestedIndex+1}`,n=new r(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(d.raw(`savepoint ${t}`));try{let s=await e(n);return await n.execute(d.raw(`release savepoint ${t}`)),s}catch(s){throw await n.execute(d.raw(`rollback to savepoint ${t}`)),s}}};var zi=class{constructor(e,t,n={}){this.client=e,this.dialect=t,this.options=n}static[u]="NodePgDriver";createSession(e){return new Tn(this.client,this.dialect,e,{logger:this.options.logger})}},Fi=class extends Kt{static[u]="NodePgDatabase"};function jr(r,e={}){let t=new at({casing:e.casing}),n;e.logger===!0?n=new yn:e.logger!==!1&&(n=e.logger);let s;if(e.schema){let c=Da(e.schema,Ba);s={fullSchema:e.schema,schema:c.tables,tableNamesMap:c.tableNamesMap}}let o=new zi(r,t,{logger:n}).createSession(s),a=new Fi(t,o,s);return a.$client=r,a}function Cn(...r){if(typeof r[0]=="string"){let e=new Nn.default.Pool({connectionString:r[0]});return jr(e,r[1])}if(Ro(r[0])){let{connection:e,client:t,...n}=r[0];if(t)return jr(t,n);let s=typeof e=="string"?new Nn.default.Pool({connectionString:e}):new Nn.default.Pool(e);return jr(s,n)}return jr(r[0],r[1])}(r=>{function e(t){return jr({},t)}r.mock=e})(Cn||(Cn={}));var tu=Pe(require("pg"),1);var{Pool:dd}=tu.default,An=process.env.DATABASE_URL;An||console.warn("DATABASE_URL not set - database features will be unavailable");var fd=An?{connectionString:An,connectionTimeoutMillis:1e4,idleTimeoutMillis:3e4,max:10}:{},Dr=An?new dd(fd):null,K=Dr?Cn(Dr,{schema:Ri}):null;var Ui=class{async getUser(e){let[t]=await K.select().from(se).where(V(se.id,e));return t||void 0}async getAllPublishedBriefs(){return(await K.select({brief:H,user:se}).from(H).leftJoin(se,V(H.ownerId,se.id)).where(V(H.status,"PUBLISHED")).orderBy(bt(H.createdAt))).map(t=>({...t.brief,organization:{name:t.user?.orgName||t.brief.orgName,slug:t.user?.orgSlug||null,logoUrl:t.user?.orgLogoUrl||null,website:t.user?.orgWebsite||null,description:t.user?.orgDescription||null}}))}async getBriefBySlug(e){let t=await K.select({brief:H,user:se}).from(H).leftJoin(se,V(H.ownerId,se.id)).where(V(H.slug,e));if(t.length===0)return;let n=t[0];return{...n.brief,organization:{name:n.user?.orgName||n.brief.orgName,slug:n.user?.orgSlug||null,logoUrl:n.user?.orgLogoUrl||null,website:n.user?.orgWebsite||null,description:n.user?.orgDescription||null}}}async getBriefById(e){let[t]=await K.select().from(H).where(V(H.id,e));return t||void 0}async getBriefsByOwnerId(e){return await K.select().from(H).where(V(H.ownerId,e)).orderBy(bt(H.createdAt))}async createBrief(e){let[t]=await K.insert(H).values(e).returning();return t}async updateBriefStatus(e,t){let[n]=await K.update(H).set({status:t,updatedAt:new Date}).where(V(H.id,e)).returning();return n}async getSubmissionsByBriefId(e){return await K.select().from(pe).where(V(pe.briefId,e)).orderBy(bt(pe.submittedAt))}async getSubmissionById(e){let[t]=await K.select().from(pe).where(V(pe.id,e));return t||void 0}async createSubmission(e){let[t]=await K.insert(pe).values(e).returning();return t}async updateSubmissionStatus(e,t,n){let s={status:t};n&&(s.selectedAt=n,t==="SELECTED"&&(s.payoutStatus="PENDING"));let[i]=await K.update(pe).set(s).where(V(pe.id,e)).returning();return i}async updateSubmissionPayout(e,t,n,s){let i={payoutStatus:t};n&&(i.paidAt=n),s&&(i.payoutNotes=s);let[o]=await K.update(pe).set(i).where(V(pe.id,e)).returning();return o}async countSubmissionsByCreatorEmail(e,t){return(await K.select().from(pe).where(V(pe.briefId,e))).filter(s=>s.creatorEmail.toLowerCase()===t.toLowerCase()).length}async getTemplatesByOwnerId(e){return await K.select().from(Ae).where(V(Ae.ownerId,e)).orderBy(bt(Ae.updatedAt))}async getTemplateById(e){let[t]=await K.select().from(Ae).where(V(Ae.id,e));return t||void 0}async createTemplate(e){let[t]=await K.insert(Ae).values(e).returning();return t}async updateTemplate(e,t){let[n]=await K.update(Ae).set({...t,updatedAt:new Date}).where(V(Ae.id,e)).returning();return n}async deleteTemplate(e){await K.delete(Ae).where(V(Ae.id,e))}},be=new Ui;var or=Pe(require("openid-client"),1),sc=require("openid-client/passport"),ft=Pe(require("passport"),1),lo=Pe(Yu(),1),ic=Pe(require("memoizee"),1),oc=Pe(nc(),1);var co=class{async getUser(e){let[t]=await K.select().from(se).where(V(se.id,e));return t}async upsertUser(e){let[t]=await K.insert(se).values(e).onConflictDoUpdate({target:se.id,set:{email:e.email,firstName:e.firstName,lastName:e.lastName,profileImageUrl:e.profileImageUrl,updatedAt:new Date}}).returning();return t}async getUserBySlug(e){let[t]=await K.select().from(se).where(V(se.orgSlug,e));return t}async updateUserOrg(e,t){let[n]=await K.update(se).set({orgName:t.orgName,orgSlug:t.orgSlug,orgWebsite:t.orgWebsite,orgDescription:t.orgDescription,isOnboarded:t.isOnboarded,updatedAt:new Date}).where(V(se.id,e)).returning();return n}},Bt=new co;var ac=(0,ic.default)(async()=>await or.discovery(new URL(process.env.ISSUER_URL??"https://replit.com/oidc"),process.env.REPL_ID),{maxAge:3600*1e3});function uc(){let e=(0,oc.default)(lo.default),t=new e({conString:process.env.DATABASE_URL,createTableIfMissing:!1,ttl:6048e5,tableName:"sessions"});return(0,lo.default)({secret:process.env.SESSION_SECRET,store:t,resave:!1,saveUninitialized:!1,cookie:{httpOnly:!0,secure:!0,maxAge:6048e5}})}function cc(r,e){r.claims=e.claims(),r.access_token=e.access_token,r.refresh_token=e.refresh_token,r.expires_at=r.claims?.exp}async function Qf(r){await Bt.upsertUser({id:r.sub,email:r.email,firstName:r.first_name,lastName:r.last_name,profileImageUrl:r.profile_image_url})}async function fo(r){r.set("trust proxy",1),r.use(uc()),r.use(ft.default.initialize()),r.use(ft.default.session());let e=await ac(),t=async(i,o)=>{let a={};cc(a,i),await Qf(i.claims()),o(null,a)},n=new Set,s=i=>{let o=`replitauth:${i}`;if(!n.has(o)){let a=new sc.Strategy({name:o,config:e,scope:"openid email profile offline_access",callbackURL:`https://${i}/api/callback`},t);ft.default.use(a),n.add(o)}};ft.default.serializeUser((i,o)=>o(null,i)),ft.default.deserializeUser((i,o)=>o(null,i)),r.get("/api/login",(i,o,a)=>{s(i.hostname),ft.default.authenticate(`replitauth:${i.hostname}`,{prompt:"login consent",scope:["openid","email","profile","offline_access"]})(i,o,a)}),r.get("/api/callback",(i,o,a)=>{s(i.hostname),ft.default.authenticate(`replitauth:${i.hostname}`,{successReturnToOrRedirect:"/",failureRedirect:"/api/login"})(i,o,a)}),r.get("/api/logout",(i,o)=>{i.logout(()=>{o.redirect(or.buildEndSessionUrl(e,{client_id:process.env.REPL_ID,post_logout_redirect_uri:`${i.protocol}://${i.hostname}`}).href)})})}var Ke=async(r,e,t)=>{let n=r.user;if(!r.isAuthenticated()||!n.expires_at)return e.status(401).json({message:"Unauthorized"});if(Math.floor(Date.now()/1e3)<=n.expires_at)return t();let i=n.refresh_token;if(!i){e.status(401).json({message:"Unauthorized"});return}try{let o=await ac(),a=await or.refreshTokenGrant(o,i);return cc(n,a),t()}catch{e.status(401).json({message:"Unauthorized"});return}};var Vf=q.object({orgName:q.string().min(1,"Organization name is required"),orgSlug:q.string().min(1,"URL slug is required").regex(/^[a-z0-9-]+$/,"Slug must be lowercase letters, numbers, and hyphens only"),orgWebsite:q.string().url().optional().or(q.literal("")),orgDescription:q.string().optional()});function mo(r){r.get("/api/auth/user",Ke,async(e,t)=>{try{let n=e.user.claims.sub,s=await Bt.getUser(n);t.json(s)}catch(n){console.error("Error fetching user:",n),t.status(500).json({message:"Failed to fetch user"})}}),r.post("/api/auth/onboard",Ke,async(e,t)=>{try{let n=e.user.claims.sub,s=Vf.safeParse(e.body);if(!s.success)return t.status(400).json({message:s.error.errors[0].message});let{orgName:i,orgSlug:o,orgWebsite:a,orgDescription:c}=s.data,f=await Bt.getUserBySlug(o);if(f&&f.id!==n)return t.status(400).json({message:"This URL slug is already taken. Please choose another."});let l=await Bt.updateUserOrg(n,{orgName:i,orgSlug:o,orgWebsite:a||null,orgDescription:c||null,isOnboarded:!0});t.json(l)}catch(n){console.error("Error during onboarding:",n),t.status(500).json({message:"Failed to complete onboarding"})}})}async function Kf(r){try{let e=await fetch(r,{headers:{"User-Agent":"Mozilla/5.0 (compatible; BountyBoard/1.0)",Accept:"text/html"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error("Failed to fetch URL");let t=await e.text(),n=b=>{let A=[new RegExp(`<meta[^>]*(?:name|property)=["']${b}["'][^>]*content=["']([^"']+)["']`,"i"),new RegExp(`<meta[^>]*content=["']([^"']+)["'][^>]*(?:name|property)=["']${b}["']`,"i")];for(let L of A){let _=t.match(L);if(_)return _[1]}},s=t.match(/<title[^>]*>([^<]+)<\/title>/i),i=n("og:site_name")||n("og:title")||(s?s[1].trim():void 0),o=n("og:description")||n("description"),a=n("og:image"),c=new URL(r),f=[/<link[^>]*rel=["'](?:icon|shortcut icon|apple-touch-icon)["'][^>]*href=["']([^"']+)["']/i,/<link[^>]*href=["']([^"']+)["'][^>]*rel=["'](?:icon|shortcut icon|apple-touch-icon)["']/i],l;for(let b of f){let A=t.match(b);if(A){l=A[1].startsWith("http")?A[1]:new URL(A[1],c.origin).href;break}}l||(l=`${c.origin}/favicon.ico`);let p=a?.startsWith("http")?a:a?new URL(a,c.origin).href:void 0;return{title:i,description:o,logo:p,favicon:l,ogImage:p}}catch(e){throw console.error("Error fetching brand metadata:",e),e}}async function lc(r,e){return e.get("/api/briefs",async(t,n)=>{try{let s=await be.getAllPublishedBriefs();n.json(s)}catch(s){console.error("Error fetching briefs:",s),n.status(500).json({error:"Failed to fetch briefs"})}}),e.get("/api/briefs/:slug",async(t,n)=>{try{let s=await be.getBriefBySlug(t.params.slug);if(!s)return n.status(404).json({error:"Brief not found"});n.json(s)}catch(s){console.error("Error fetching brief:",s),n.status(500).json({error:"Failed to fetch brief"})}}),e.post("/api/briefs",async(t,n)=>{try{let s=Di.parse(t.body),i=await be.createBrief(s);n.status(201).json(i)}catch(s){if(console.error("Error creating brief:",s),s.name==="ZodError")return n.status(400).json({error:"Validation failed",details:s.errors});n.status(500).json({error:"Failed to create brief"})}}),e.get("/api/briefs/:id/submissions",async(t,n)=>{try{let s=parseInt(t.params.id),i=await be.getSubmissionsByBriefId(s);n.json(i)}catch(s){console.error("Error fetching submissions:",s),n.status(500).json({error:"Failed to fetch submissions"})}}),e.post("/api/submissions",async(t,n)=>{try{let s=Li.parse(t.body),i=await be.createSubmission(s);n.status(201).json(i)}catch(s){if(console.error("Error creating submission:",s),s.name==="ZodError")return n.status(400).json({error:"Validation failed",details:s.errors});n.status(500).json({error:"Failed to create submission"})}}),e.patch("/api/submissions/:id/status",async(t,n)=>{try{let s=parseInt(t.params.id),{status:i}=t.body;if(!["RECEIVED","IN_REVIEW","SELECTED","NOT_SELECTED"].includes(i))return n.status(400).json({error:"Invalid status"});let o=i==="SELECTED"?new Date:void 0,a=await be.updateSubmissionStatus(s,i,o);n.json(a)}catch(s){console.error("Error updating submission status:",s),n.status(500).json({error:"Failed to update submission status"})}}),e.patch("/api/submissions/:id/payout",async(t,n)=>{try{let s=parseInt(t.params.id),{payoutStatus:i,notes:o}=t.body;if(!["NOT_APPLICABLE","PENDING","PAID"].includes(i))return n.status(400).json({error:"Invalid payout status"});let a=i==="PAID"?new Date:void 0,c=await be.updateSubmissionPayout(s,i,a,o);n.json(c)}catch(s){console.error("Error updating payout:",s),n.status(500).json({error:"Failed to update payout"})}}),e.post("/api/fetch-brand",async(t,n)=>{try{let{url:s}=t.body;if(!s||typeof s!="string")return n.status(400).json({error:"URL is required"});let i=s.trim();!i.startsWith("http://")&&!i.startsWith("https://")&&(i="https://"+i);try{new URL(i)}catch{return n.status(400).json({error:"Invalid URL format"})}let o=await Kf(i);n.json(o)}catch(s){console.error("Error fetching brand metadata:",s),n.status(500).json({error:"Failed to fetch brand information from this URL"})}}),e.get("/api/templates",Ke,async(t,n)=>{try{let s=t.user.claims.sub,i=await be.getTemplatesByOwnerId(s);n.json(i)}catch(s){console.error("Error fetching templates:",s),n.status(500).json({error:"Failed to fetch templates"})}}),e.get("/api/templates/:id",Ke,async(t,n)=>{try{let s=parseInt(t.params.id),i=await be.getTemplateById(s);if(!i)return n.status(404).json({error:"Template not found"});if(i.ownerId!==t.user.claims.sub)return n.status(403).json({error:"Not authorized"});n.json(i)}catch(s){console.error("Error fetching template:",s),n.status(500).json({error:"Failed to fetch template"})}}),e.post("/api/templates",Ke,async(t,n)=>{try{let s=t.user.claims.sub,i=Bi.parse({...t.body,ownerId:s}),o=await be.createTemplate(i);n.status(201).json(o)}catch(s){if(console.error("Error creating template:",s),s.name==="ZodError")return n.status(400).json({error:"Validation failed",details:s.errors});n.status(500).json({error:"Failed to create template"})}}),e.patch("/api/templates/:id",Ke,async(t,n)=>{try{let s=parseInt(t.params.id),i=await be.getTemplateById(s);if(!i)return n.status(404).json({error:"Template not found"});if(i.ownerId!==t.user.claims.sub)return n.status(403).json({error:"Not authorized"});let o=await be.updateTemplate(s,t.body);n.json(o)}catch(s){console.error("Error updating template:",s),n.status(500).json({error:"Failed to update template"})}}),e.delete("/api/templates/:id",Ke,async(t,n)=>{try{let s=parseInt(t.params.id),i=await be.getTemplateById(s);if(!i)return n.status(404).json({error:"Template not found"});if(i.ownerId!==t.user.claims.sub)return n.status(403).json({error:"Not authorized"});await be.deleteTemplate(s),n.json({success:!0})}catch(s){console.error("Error deleting template:",s),n.status(500).json({error:"Failed to delete template"})}}),r}var dc=Pe(require("express"),1),fc=Pe(require("fs"),1),po=Pe(require("path"),1);function mc(r){let e=po.default.resolve(__dirname,"public");if(!fc.default.existsSync(e))throw new Error(`Could not find the build directory: ${e}, make sure to build the client first`);r.use(dc.default.static(e)),r.use("*",(t,n)=>{n.sendFile(po.default.resolve(e,"index.html"))})}var hc=require("http");var nt=(0,Ln.default)(),pc=(0,hc.createServer)(nt);nt.use(Ln.default.json({verify:(r,e,t)=>{r.rawBody=t}}));nt.use(Ln.default.urlencoded({extended:!1}));function he(r,e="express"){let t=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${t} [${e}] ${r}`)}nt.use((r,e,t)=>{let n=Date.now(),s=r.path,i,o=e.json;e.json=function(a,...c){return i=a,o.apply(e,[a,...c])},e.on("finish",()=>{let a=Date.now()-n;if(s.startsWith("/api")){let c=`${r.method} ${s} ${e.statusCode} in ${a}ms`;i&&(c+=` :: ${JSON.stringify(i)}`),he(c)}}),t()});(async()=>{try{if(he("Initializing server..."),Dr)try{await Dr.query("SELECT NOW()"),he("Database connection successful")}catch(e){he(`Database connection warning: ${e}`,"warn"),he("Continuing without database - will retry on requests","warn")}else he("Database not configured - running without database","warn");await fo(nt),mo(nt),he("Authentication configured"),await lc(pc,nt),he("Routes registered"),nt.use((e,t,n,s)=>{let i=e.status||e.statusCode||500,o=e.message||"Internal Server Error";he(`Error: ${o}`,"error"),n.status(i).json({message:o})}),mc(nt),he("Serving static files");let r=parseInt(process.env.PORT||"5000",10);await new Promise((e,t)=>{pc.listen({port:r,host:"0.0.0.0",reusePort:!0},()=>{he(`Server successfully started on port ${r}`),e()}).on("error",s=>{he(`Failed to start server: ${s}`,"error"),t(s)})})}catch(r){he(`Fatal error during startup: ${r}`,"error"),console.error(r),process.exit(1)}})();process.on("uncaughtException",r=>{he(`Uncaught exception: ${r}`,"error"),console.error(r),process.exit(1)});process.on("unhandledRejection",(r,e)=>{he(`Unhandled rejection at ${e}: ${r}`,"error"),console.error(r),process.exit(1)});0&&(module.exports={log});
/*! Bundled license information:

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

depd/index.js:
  (*!
   * depd
   * Copyright(c) 2014-2018 Douglas Christopher Wilson
   * MIT Licensed
   *)

on-headers/index.js:
  (*!
   * on-headers
   * Copyright(c) 2014 Douglas Christopher Wilson
   * MIT Licensed
   *)

parseurl/index.js:
  (*!
   * parseurl
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2014-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

random-bytes/index.js:
  (*!
   * random-bytes
   * Copyright(c) 2016 Douglas Christopher Wilson
   * MIT Licensed
   *)

uid-safe/index.js:
  (*!
   * uid-safe
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2017 Douglas Christopher Wilson
   * MIT Licensed
   *)

express-session/session/cookie.js:
  (*!
   * Connect - session - Cookie
   * Copyright(c) 2010 Sencha Inc.
   * Copyright(c) 2011 TJ Holowaychuk
   * MIT Licensed
   *)
  (*!
   * Prototype.
   *)

express-session/session/session.js:
  (*!
   * Connect - session - Session
   * Copyright(c) 2010 Sencha Inc.
   * Copyright(c) 2011 TJ Holowaychuk
   * MIT Licensed
   *)

express-session/session/store.js:
  (*!
   * Connect - session - Store
   * Copyright(c) 2010 Sencha Inc.
   * Copyright(c) 2011 TJ Holowaychuk
   * MIT Licensed
   *)

express-session/session/memory.js:
  (*!
   * express-session
   * Copyright(c) 2010 Sencha Inc.
   * Copyright(c) 2011 TJ Holowaychuk
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

express-session/index.js:
  (*!
   * express-session
   * Copyright(c) 2010 Sencha Inc.
   * Copyright(c) 2011 TJ Holowaychuk
   * Copyright(c) 2014-2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
